<!DOCTYPE html><html><head><meta charset="utf-8"><title>Centos 编译安装 memcache 以及基础配置</title><meta name="keywords" content="memcache,memcache 安装,linux,服务器搭建,memcache 编译安装,memcache配置,php配置memcached"><meta name="description" content="CentOS8编译安装memcache CentOS7编译安装 memcache linux编译安装memcache本篇文章将采用源代码编译的方式安装memcache数据库，并介绍memcache的基本设置，以及 php 扩展的安装，采用源码编译方式安装，并配置开机启动脚本。"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/style/main.css"><link rel="stylesheet" href="/style/fontawesome.css"><link rel="stylesheet" href="/style/katex.min.css"><link rel="stylesheet" href="/style/gitalk.css"><script async src="https://www.googletagmanager.com/gtag/js?id=G-2GM6102E19"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2GM6102E19")</script><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="codeover" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="codeover" type="application/rss+xml"></head><body><div id="app" class="main"><div class="site-header-container"><div class="site-header"><div class="left"> <a href="https://www.codeover.cn"><img class="avatar" src="/images/avatar.png" alt="" width="32px" height="32px"></a><a href="https://www.codeover.cn"><h1 class="site-title">codeover</h1></a></div><div class="right"><i class="icon menu-switch icon-menu-outline"></i></div></div></div><div class="menu-container" style="height:0;opacity:0"><nav class="menu-list"> <a href="/" class="menu purple-link">首页</a> <a href="/tags/" class="menu purple-link">标签</a> <a href="/categories/" class="menu purple-link">分类</a> <a href="/archives/" class="menu purple-link">归档</a> <a href="/about/" class="menu purple-link">关于</a></nav></div><div class="content-container"><div class="post-detail"><h2 class="post-title">Centos 编译安装 memcache 以及基础配置</h2><div class="post-info post-detail-info"><span><i class="icon-calendar-outline"></i> 2022-05-22</span><span><i class="icon-pricetags-outline"></i> <a href="/tags/linux/">linux</a></span></div><div class="post-content-wrapper"><div class="post-content"><p>memcached是一套分散式的高速缓冲记忆体系统，由LiveJournal的Brad Fitzpatrick开发，但目前被许多网站使用。这是一套开放原始码软体，以BSD license授权释出。</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="下载安装文件"><a href="#下载安装文件" class="headerlink" title="下载安装文件"></a>下载安装文件</h3><p>保险起见使用 memcached 官网下载：<a target="_blank" rel="noopener" href="http://memcached.org/downloads">http://memcached.org/downloads</a><br>使用官网下载速度较慢，但是安全性有保障，如对安全性没有要求也可百度搜索相关镜像，本文选择官网最新稳定版本 memcached 1.6.15</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://memcached.org/files/memcached-1.6.15.tar.gz</span><br><span class="line">tar -zxvf memcached-1.6.15.tar.gz</span><br><span class="line"><span class="built_in">cd</span> memcached-1.6.15</span><br></pre></td></tr></tbody></table></figure><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libevent-devel -y</span><br></pre></td></tr></tbody></table></figure><br><blockquote><p>注意：当前 Centos 官方镜像已停止服务，<code>yum install</code> 安装 <code>devel</code> 软件时，如报错无法安装可尝试将 <code>/etc/yum.repos.d/</code> 目录下的 <code>CentOS-Base.repo.rpmsave</code> 中的文件内容覆盖至 <code>CentOS-Linux-BaseOS.repo</code> ，<code>CentOS-AppStream.repo.rpmsave</code> 覆盖至 <code>CentOS-Linux-AppStream.repo</code>，操作前请注意备份</p></blockquote><h2 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成编译文件</span></span><br><span class="line">./configure --prefix=/www/server/memcached</span><br><span class="line"><span class="comment"># 编译并安装</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></tbody></table></figure><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/www/server/memcached/bin/memcached -uwww -p11211 -P /var/run/memcached.pid -d -l127.0.0.1</span><br></pre></td></tr></tbody></table></figure><ul><li><code>/www/server/memcached</code> 编译时指定的 memcached 安装路径</li><li><code>-u</code> 指定运行用户，示例中使用 <code>www</code> 用户运行</li><li><code>-p</code> 指定运行端口，不指定则默认为 <code>11211</code></li><li><code>-P</code> 指定运行的 <code>pid</code> 文件储存位置</li><li><code>-d</code> 以守护进程方式运行，即后台运行</li><li><code>-l</code> 指定监听的 ip ，示例中监听 <code>127.0.0.1</code> 即不允许外网连接</li></ul><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>依次运行下列命令：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">telnet 127.0.0.1 11211</span><br><span class="line"><span class="built_in">set</span> key 0 0 15</span><br><span class="line">hello memcached <span class="comment"># 输出 STORED</span></span><br><span class="line">get key <span class="comment"># 输出 VALUE key 0 15 / hello memcached / END</span></span><br></pre></td></tr></tbody></table></figure><p>如图所示：</p><p><img src="http://cdn.codeover.cn/img/image-20220520234722981.png-imageFop" alt="测试截图"></p><h3 id="php-扩展安装"><a href="#php-扩展安装" class="headerlink" title="php 扩展安装"></a>php 扩展安装</h3><p>我们需要使用 php 连接 memcached 服务的话，就要安装对应的扩展</p><p>pecl 官网：<a target="_blank" rel="noopener" href="https://pecl.php.net/">https://pecl.php.net</a>，在右上角输入 memcached 并搜索并进入，复制相应的下载链接</p><p><img src="http://cdn.codeover.cn/img/image-20220521225539313.png-imageFop" alt="扩展安装截图"></p><p>安装命令如下：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载</span></span><br><span class="line">wget https://pecl.php.net/get/memcached-3.2.0.tgz</span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -zxvf memcached-3.2.0.tgz</span><br><span class="line"><span class="built_in">cd</span> memcached-3.2.0</span><br><span class="line"><span class="comment"># /www/server/php81 为 PHP 安装路径</span></span><br><span class="line">/www/server/php81/bin/phpize</span><br><span class="line">yum install libmemcached-devel -y</span><br><span class="line">./configure --with-php-config=/www/server/php81/bin/php-config</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="comment"># 此时屏幕会显示 Installing shared extensions:     /www/server/php81/lib/php/extensions/no-debug-non-zts-20210902/</span></span><br></pre></td></tr></tbody></table></figure><p>修改 php 安装目录下 <code>etc/php.ini</code> 文件中新增一行 <code>extension=memcached</code> ，如图所示：</p><p><img src="http://cdn.codeover.cn/img/image-20220522223958549.png-imageFop" alt="修改PHP.ini图示"></p><p><img src="http://cdn.codeover.cn/img/image-20220522224235937.png-imageFop" alt="安装成功截图"></p><p>如果你在安装 <code>libmemcached-devel</code> 时提示 <code>No match for argument: libmemcached-devel</code>，请尝试按照以下方式进行编译安装：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wget https://launchpad.net/libmemcached/1.0/1.0.18/+download/libmemcached-1.0.18.tar.gz</span><br><span class="line">tar -zxvf libmemcached-1.0.18.tar.gz</span><br><span class="line"><span class="built_in">cd</span> libmemcached-1.0.18</span><br><span class="line">./configure --prefix=/usr/local/libmemcached --with-memcached</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">./configure --with-php-config=/www/server/php81/bin/php-config --with-libmemcached-dir=/usr/local/libmemcached --disable-memcached-sasl</span><br><span class="line"><span class="comment"># 重新运行上一步中 ./configure 之后的步骤</span></span><br></pre></td></tr></tbody></table></figure><p>注意：如在执行 <code>make</code> 中遇到 <code>clients/memflush.cc:42:22: error: ISO C++ forbids comparison between pointer and integer [-fpermissive]</code> 的报错，可直接使用 vim 将 <code>clients/memflush.cc</code> 文件的 42 行的 <code>false</code> 修改为 0，然后重新执行 <code>nake &amp;&amp; make install</code> 即可成功</p><p><img src="http://cdn.codeover.cn/img/image-20220522220846044.png-imageFop" alt="报错截图"></p><p><img src="http://cdn.codeover.cn/img/image-20220522221346542.png-imageFop" alt="修改截图"></p></div><div class="top-div"><ol class="top-box"><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="top-box-text">准备工作</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E6%96%87%E4%BB%B6"><span class="top-box-text">下载安装文件</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="top-box-text">安装依赖</span></a></li></ol></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="top-box-text">安装与配置</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%AE%89%E8%A3%85"><span class="top-box-text">安装</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%90%AF%E5%8A%A8"><span class="top-box-text">启动</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E6%B5%8B%E8%AF%95"><span class="top-box-text">测试</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#php-%E6%89%A9%E5%B1%95%E5%AE%89%E8%A3%85"><span class="top-box-text">php 扩展安装</span></a></li></ol></li></ol></div></div></div><div class="next-post"><a class="purple-link" href="/centos-install-php/"><h3 class="post-title"> 下一篇：Centos 编译安装 php 与配置</h3></a></div></div><div id="gitalk-container"></div><footer><div class="site-footer"><div class="social-container"><a href="https://github.com/f-dong" target="_blank"><i class="fab fa-github"></i></a></div> Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="https://github.com/f-dong/hexo-theme-minimalism" target="_blank">Theme</a> | <a class="icp" href="https://beian.miit.gov.cn" target="_blank">豫ICP备2022011962号</a></div></footer></div><script src="/js/jquery.min.js"></script><script>$(".menu-switch").click(function(){if($(this).hasClass("icon-menu-outline"))$(this).removeClass(" icon-menu-outline ").addClass("icon-close-outline"),$(".menu-container").css("opacity","1").css("height","auto");else{$(this).addClass(" icon-menu-outline ").removeClass("icon-close-outline"),$(".menu-container").css("opacity","0");var s=$(this);setTimeout(function(){s.hasClass("icon-menu-outline")&&$(".menu-container").css("height","0")},600)}})</script><script src="/js/gitalk.min.js"></script><script>var gitalk=new Gitalk({clientID:"eaa8ec37487184406145",clientSecret:"77f9955d0267c1331df7cc706cfa385d2befb9c6",repo:"blog",owner:"f-dong",admin:["f-dong"],id:location.pathname.slice(1,location.pathname.lastIndexOf("/")).substring(0,49),distractionFreeMode:!1,createIssueManually:!0});gitalk.render("gitalk-container")</script><script src="/js/gitalk.min.js"></script><script>var gitalk=new Gitalk({clientID:"eaa8ec37487184406145",clientSecret:"77f9955d0267c1331df7cc706cfa385d2befb9c6",repo:"blog",owner:"f-dong",admin:["f-dong"],id:location.pathname.slice(1,location.pathname.lastIndexOf("/")).substring(0,49),distractionFreeMode:!1});gitalk.render("gitalk-container")</script><script>
        // 代码语言
        $(function () {
          $('code').each(function () {
            var code_language = $(this).attr('class');

            if (!code_language) {
              return true;
            }
            var lang_name = code_language.replace("line-numbers", "").trim().replace("highlight", "").trim().replace("language-", "").trim();

            $(this).attr('data-content-after', lang_name || 'CODE');
          });
          $('.highlight').each(function () {
            var code_language = $(this).attr('class');

            if (!code_language) {
              return true;
            }
            var lang_name = code_language.replace("highlight", "").trim();

            $(this).attr('data-content-after', lang_name || 'CODE');
          });
        });

        let mainNavLinks = document.querySelectorAll(".top-box a");

        window.addEventListener("scroll", event => {
          let fromTop = window.scrollY + 100;

          mainNavLinks.forEach((link, index) => {
            let section = document.getElementById(decodeURI(link.hash).substring(1));
            let nextSection = null
            if (mainNavLinks[index + 1]) {
              nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
            }
            if (section.offsetTop <= fromTop) {
              if (nextSection) {
                if (nextSection.offsetTop > fromTop) {
                  link.classList.add("current");
                } else {
                  link.classList.remove("current");
                }
              } else {
                link.classList.add("current");
              }
            } else {
              link.classList.remove("current");
            }
          });
        });
    </script></body></html>