<!DOCTYPE html><html><head><meta charset="utf-8"><title>Centos 编译安装 php 与配置</title><meta name="keywords" content="php,php 安装,php编译安装,php8.0 编译安装,php-fpm,服务器搭建"><meta name="description" content="PHP（全称：PHP：Hypertext Preprocessor，即“PHP：超文本预处理器”）是一种开源的通用计算机脚本语言，尤其适用于网络开发并可嵌入HTML中使用。PHP的语法借鉴吸收C语言、Java和Perl等流行计算机语言的特点，易于一般程序员学习。PHP的主要目标是允许网络开发人员快速编写动态页面。"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/style/main.css"><link rel="stylesheet" href="/style/fontawesome.css"><link rel="stylesheet" href="/style/jquery.fancybox.min.css"><link rel="stylesheet" href="/style/gitalk.css"><script async src="https://www.googletagmanager.com/gtag/js?id=G-2GM6102E19"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2GM6102E19")</script><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="codeover" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="codeover" type="application/rss+xml"></head><body><div id="app" class="main"><div class="site-header-container"><div class="site-header"><div class="left"> <a href="https://www.codeover.cn"><img class="avatar" src="/images/avatar.png" alt="" width="32px" height="32px"></a><a href="https://www.codeover.cn"><h1 class="site-title">codeover</h1></a></div><div class="right"><i class="icon menu-switch icon-menu-outline"></i></div></div></div><div class="menu-container" style="height:0;opacity:0"><nav class="menu-list"> <a href="/" class="menu purple-link">首页</a> <a href="/tags/" class="menu purple-link">标签</a> <a href="/categories/" class="menu purple-link">分类</a> <a href="/archives/" class="menu purple-link">归档</a> <a href="/about/" class="menu purple-link">关于</a></nav></div><div class="content-container"><div class="post-detail"><h2 class="post-title">Centos 编译安装 php 与配置</h2><div class="post-info post-detail-info"><span><i class="icon-calendar-outline"></i> 2022-05-15</span><span><i class="icon-pricetags-outline"></i> <a href="/tags/linux/">linux ，</a> <a href="/tags/php/">php</a></span></div><div class="post-content-wrapper"><div class="post-content"><p>PHP（全称：PHP：Hypertext Preprocessor，即“PHP：超文本预处理器”）是一种开源的通用计算机脚本语言，尤其适用于网络开发并可嵌入HTML中使用。PHP的语法借鉴吸收C语言、Java和Perl等流行计算机语言的特点，易于一般程序员学习。PHP的主要目标是允许网络开发人员快速编写动态页面。</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="下载安装文件"><a href="#下载安装文件" class="headerlink" title="下载安装文件"></a>下载安装文件</h3><p>保险起见使用 php 官网下载：<a target="_blank" rel="noopener" href="https://www.php.net/downloads">https://www.php.net/downloads</a><br>使用官网下载速度较慢，但是安全性有保障，如对安全性没有要求也可百度搜索相关镜像，本文选择最新稳定版本 PHP 8.1.6</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.php.net/distributions/php-8.1.6.tar.gz</span><br><span class="line">tar -zxvf php-8.1.6.tar.gz</span><br><span class="line"><span class="built_in">cd</span> php-8.1.6</span><br></pre></td></tr></tbody></table></figure><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libxml2 libxml2-devel libsqlite3x-devel openssl bzip2 libcurl-devel libcurl libjpeg libpng freetype gmp libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel zlib zlib-devel glibc glib2 ncurses curl gdbm-devel db4-devel libXpm-devel libX11-devel gd-devel gmp-devel expat-devel xmlrpc-c xmlrpc-c-devel libicu-devel libmcrypt-devel libmemcached-devel -y</span><br></pre></td></tr></tbody></table></figure><br><blockquote><p>注意：当前 Centos 官方镜像已停止服务，<code>yum install</code> 安装 <code>devel</code> 软件时，如报错无法安装可尝试将 <code>/etc/yum.repos.d/</code> 目录下的 <code>CentOS-Base.repo.rpmsave</code> 中的文件内容覆盖至 <code>CentOS-Linux-BaseOS.repo</code> ，<code>CentOS-AppStream.repo.rpmsave</code> 覆盖至 <code>CentOS-Linux-AppStream.repo</code>，操作前请注意备份</p></blockquote><p>因 yum 源中没有 oniguruma 包，这里使用 github 源码编译安装，项目地址：<a target="_blank" rel="noopener" href="https://github.com/kkos/oniguruma">https://github.com/kkos/oniguruma</a></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/kkos/oniguruma/releases/download/v6.9.8/onig-6.9.8.tar.gz</span><br><span class="line">tar -zxvf onig-6.9.8.tar.gz</span><br><span class="line"><span class="built_in">cd</span> onig-6.9.8</span><br><span class="line">./configure --prefix=/usr</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></tbody></table></figure><h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><p>安全起见，我们需要创建一个用户用于运行 php，一般这个用户是禁止登陆的，本文创建用户名与用户组均为 <code>www</code>，这个名称可以自定义</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建用户组</span></span><br><span class="line">groupadd www</span><br><span class="line"><span class="comment"># 创建用户</span></span><br><span class="line">useradd -g www www -M -s /sbin/nologin</span><br></pre></td></tr></tbody></table></figure><ul><li><code>-g www</code> 指定用户组</li><li><code>-M</code> 不创建家目录（程序运行不需要家目录）</li><li><code>-s /sbin/nologin</code> 不允许登录，更加安全</li></ul><h2 id="编译并安装"><a href="#编译并安装" class="headerlink" title="编译并安装"></a>编译并安装</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成编译文件</span></span><br><span class="line">./configure --prefix=/www/server/php81 --with-config-file-path=/www/server/php81/etc --enable-fpm --with-fpm-group=www --enable-mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-iconv-dir --with-freetype --with-mcrypt --with-jpeg --with-png -with-zlib --with-libxml-dir --enable-xml --disable-rpath --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --with-curl -enable-mbstring --enable-gd --with-openssl --with-mhash --enable-pcntl --with-xmlrpc --enable-zip --enable-soap --with-gettext --enable-opcache --with-xsl --enable-sockets --enable-mbregex --enable-ftp --with-webp</span><br><span class="line"><span class="comment"># 编译并安装</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="comment"># 复制配置文件</span></span><br><span class="line"><span class="built_in">cp</span> php.ini-production /www/server/php81/etc/php.ini</span><br><span class="line"><span class="comment"># 或者使用 development</span></span><br><span class="line"><span class="built_in">cp</span> php.ini-development /www/server/php81/etc/php.ini</span><br></pre></td></tr></tbody></table></figure><p>如果使用 <code>apache</code> 的话，需要在编译参数中新增 <code>--with-apxs2=/www/server/apache/bin/apxs</code>，同时 <code>--enable-fpm</code> 参数可去除，其中 <code>/www/server/apache</code> 为 <code>apache</code> 安装目录，编译完成后在 <code>apache</code> 的配置文件中解注释对 <code>php_module</code> 的注释即可，本文不细讲 <code>apache</code> 配置。</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><p>在 <code>/etc/profile</code> 下新增 <code>PATH=$PATH:/www/server/php81/bin &amp;&amp; export PATH</code>，使用 <code>source /etc/profile</code> 使配置立即生效。</p><p>创建 <code>php-fpm</code> 软链接：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /www/server/php81/sbin/php-fpm /www/server/php81/bin/php-fpm</span><br></pre></td></tr></tbody></table></figure><h3 id="nginx-配置-php"><a href="#nginx-配置-php" class="headerlink" title="nginx 配置 php"></a>nginx 配置 php</h3><ol><li>复制配置文件，如果之前已经复制过请跳过此步骤：</li></ol><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /www/server/php81/etc/php-fpm.conf.default /www/server/php81/etc/php-fpm.conf</span><br><span class="line"><span class="built_in">cp</span> /www/server/php81/etc/php-fpm.d/www.conf.default /www/server/php81/etc/php-fpm.d/www.conf</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>启动 php-fpm：</li></ol><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/www/server/php81/sbin/php-fpm</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li>修改 nginx 配置文件</li></ol><p>编辑 <code>nginx.conf</code> 文件，在对应的 <code>server</code> 下新增如下内容：</p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~ [^/]\.php(/|$)</span> {</span><br><span class="line">    <span class="attribute">fastcgi_pass</span>   <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">    <span class="attribute">fastcgi_index</span>  index.php;</span><br><span class="line">    <span class="attribute">include</span>        fastcgi.conf;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>重启 nginx ，<code>nginx -s reload</code>，在网站根目录新建 <code>phpinfo.php</code> 文件：</p><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></tbody></table></figure><p><img src="http://cdn.codeover.cn/img/6281217c09475431299ffedb.jpg-imageFop" alt="配置成功截图"></p><h3 id="nginx-php-多版本共存"><a href="#nginx-php-多版本共存" class="headerlink" title="nginx php 多版本共存"></a>nginx php 多版本共存</h3><p>在日常的开发中，不同项目可能需要不同版本的 <code>php</code> 来运行，这就需要通过一些配置来实现 <code>php</code> 的共存。多个 <code>php</code> 版本共存时，需要在编译时将不同版本的 <code>php</code> 安装到不同的目录。</p><p>打开 <code>php</code> 安装路径，编辑文件 <code>etc/php-fpm.d/www.conf</code> 或 <code>etc/php-fpm.conf</code>，在文件中新增或修改以下项：</p><figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[www]</span></span><br><span class="line"><span class="comment">; 根据版本配置，比如 php8.1 配置为 php-cgi-81.sock</span></span><br><span class="line"><span class="attr">listen</span> = /tmp/php-cgi-<span class="number">81</span>.sock</span><br><span class="line"><span class="attr">listen.backlog</span> = <span class="number">8192</span></span><br><span class="line"><span class="attr">listen.allowed_clients</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="comment">; 运行 master 进程用户名，一定要设置！！并且 listen 中设置的文件 nginx 必须有读权限，否则会报错</span></span><br><span class="line"><span class="attr">listen.owner</span> = www</span><br><span class="line"><span class="comment">; 运行 master 进程用户名，参考上一个</span></span><br><span class="line"><span class="attr">listen.group</span> = www</span><br><span class="line"><span class="attr">listen.mode</span> = <span class="number">0666</span></span><br><span class="line"><span class="comment">; worker 进程运行的用户，该用户需要有运行的 PHP 文件的读权限，如涉及文件上传还需要对应目录的写权限</span></span><br><span class="line"><span class="attr">user</span> = www</span><br><span class="line"><span class="comment">; worker 进程的用户组，参考上一项</span></span><br><span class="line"><span class="attr">group</span> = www</span><br><span class="line"><span class="comment">; 动态调整 worker 数</span></span><br><span class="line"><span class="attr">pm</span> = dynamic</span><br><span class="line"><span class="comment">; 依据版本设置 如 php8.1 配置为 phpfpm_81_status</span></span><br><span class="line"><span class="attr">pm.status_path</span> = /phpfpm_81_status</span><br><span class="line"><span class="comment">; 最大 worker 进程数 一般设置为 内存/50M</span></span><br><span class="line"><span class="attr">pm.max_children</span> = <span class="number">50</span></span><br><span class="line"><span class="comment">; 启动时的 worker 进程数</span></span><br><span class="line"><span class="attr">pm.start_servers</span> = <span class="number">5</span></span><br><span class="line"><span class="comment">; 限制时的最小 worder 进程数</span></span><br><span class="line"><span class="attr">pm.min_spare_servers</span> = <span class="number">5</span></span><br><span class="line"><span class="comment">; 限制时的最大 worder 进程数</span></span><br><span class="line"><span class="attr">pm.max_spare_servers</span> = <span class="number">10</span></span><br><span class="line"><span class="comment">; 请求超时时间</span></span><br><span class="line"><span class="attr">request_terminate_timeout</span> = <span class="number">100</span></span><br><span class="line"><span class="comment">; 慢日志记录时间，请求事件超出此时间会记录日志</span></span><br><span class="line"><span class="attr">request_slowlog_timeout</span> = <span class="number">30</span></span><br><span class="line"><span class="comment">; 慢日志目录，目录一定要存在且上面设置的 user 用户要有写权限</span></span><br><span class="line"><span class="attr">slowlog</span> = /www/wwwlogs/php/slow.log</span><br></pre></td></tr></tbody></table></figure><p>随后在 nginx 配置文件，对应的 server 中修改 <code>fastcgi_pass</code> 为刚才设置中的 <code>listen</code> 对应的路径，注意此文件 nginx 运行用户必须有读权限，否则会报错：</p><figure class="highlight diff"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> location ~ [^/]\.php(/|$) {</span><br><span class="line"><span class="deletion">-    fastcgi_pass   127.0.0.1:9000;</span></span><br><span class="line"><span class="addition">+    fastcgi_pass   unix:/tmp/php81.sock;</span></span><br><span class="line">     fastcgi_index  index.php;</span><br><span class="line">     include        fastcgi.conf;</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure><blockquote><p><code>php-fpm</code> 即 <code>php-Fastcgi Process Manager</code>，<code>php-fpm</code> 是 <code>FastCGI</code> 的实现，并提供了进程管理的功能。<code>php-fpm</code> 进程包含 <code>master</code> 进程与 <code>worker</code> 进程，一般情况下，<code>master</code> 进程只有一个，负责监听端口、调度请求，而 <code>worder</code> 进程则有多个，每个进程内部都嵌入了一个 <code>PHP</code> 解释器，是 <code>PHP</code> 代码真正运行的地方。前文设置中的 <code>worker</code> 即 <code>php-fpm</code> 的 <code>worker</code> 进程数量。</p></blockquote><h3 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h3><p>编辑文件 <code>/etc/init.d/php-fpm81</code>，如需多版本兼容文件名后加上当前版本，如这里使用 <code>php-fpm81</code>，写入如下内容：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">chkconfig: - 51 64</span></span><br><span class="line"></span><br><span class="line">. /etc/init.d/functions</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">php-fpm 路径</span></span><br><span class="line">exec=/www/server/php81/sbin/php-fpm</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">锁文件 用于识别当前软件是否在运行</span></span><br><span class="line">lock=/var/lock/subsys/php-fpm81</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">标识 输出信息用 可随意修改</span></span><br><span class="line">proc=php-fpm81</span><br><span class="line"></span><br><span class="line">function start() {</span><br><span class="line">    pidofproc $exec &gt; /dev/null</span><br><span class="line">    [ $? = 0 ] &amp;&amp; echo "${proc} 正在运行中" &amp;&amp; exit</span><br><span class="line">    daemon $exec</span><br><span class="line">    if [ $? = 0 ]; then</span><br><span class="line">        echo "${proc} 启动成功"</span><br><span class="line">        rm -f lock</span><br><span class="line">        touch $lock</span><br><span class="line">    else</span><br><span class="line">      echo "${proc} 启动失败 $?"</span><br><span class="line">    fi</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">function stop() {</span><br><span class="line">    pidofproc $exec &gt; /dev/null</span><br><span class="line">    [ $? != 0 ] &amp;&amp; echo "${proc} 未运行" &amp;&amp; exit</span><br><span class="line">    killproc $exec</span><br><span class="line">    if [[ $? == 0 ]]; then</span><br><span class="line">        echo "${proc} 停止成功"</span><br><span class="line">        rm -f $lock</span><br><span class="line">    else</span><br><span class="line">      echo "${proc} 停止失败 $?"</span><br><span class="line">    fi</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">function reload() {</span><br><span class="line">    killproc $exec -HUP</span><br><span class="line">    if [[ $? == 0 ]]; then</span><br><span class="line">        echo "平滑重启成功"</span><br><span class="line">    else</span><br><span class="line">        echo "平滑重启失败 $?"</span><br><span class="line">    fi</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">function restart() {</span><br><span class="line">    stop</span><br><span class="line">    start</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">function procStatus() {</span><br><span class="line">    status $exec &gt; /dev/null</span><br><span class="line">    if [[ $? == 0 ]]; then</span><br><span class="line">        echo "${proc} 已启动"</span><br><span class="line">    else</span><br><span class="line">        echo "${proc} 未启动"</span><br><span class="line">    fi</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">case "$1" in</span><br><span class="line">  start)</span><br><span class="line">    start</span><br><span class="line">    ;;</span><br><span class="line">  stop)</span><br><span class="line">    stop</span><br><span class="line">    ;;</span><br><span class="line">  reload)</span><br><span class="line">    reload</span><br><span class="line">    ;;</span><br><span class="line">  restart)</span><br><span class="line">    restart</span><br><span class="line">    ;;</span><br><span class="line">  status)</span><br><span class="line">    procStatus</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    echo $"Usage: $0 {start|stop|reload|restart|status}"</span><br><span class="line">esac</span><br></pre></td></tr></tbody></table></figure><p>随后添加为开机自启即可，如下：( <code>php-fpm81</code> 是上一步自定义得到文件名)</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加运行权限</span></span><br><span class="line"><span class="built_in">chmod</span> +x /etc/init.d/php-fpm81</span><br><span class="line">chkconfig --add php-fpm81</span><br><span class="line">chkconfig php-fpm81 on</span><br></pre></td></tr></tbody></table></figure><p>手动操作命令如下：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动</span></span><br><span class="line">/etc/init.d/php-fpm81 start</span><br><span class="line"><span class="comment"># 停止</span></span><br><span class="line">/etc/init.d/php-fpm81 stop</span><br><span class="line"><span class="comment"># 平滑重启</span></span><br><span class="line">/etc/init.d/php-fpm81 reload</span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">/etc/init.d/php-fpm81 restart</span><br><span class="line"><span class="comment"># 运行状态</span></span><br><span class="line">/etc/init.d/php-fpm81 status</span><br></pre></td></tr></tbody></table></figure></div><div class="top-div"><ol class="top-box"><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="top-box-text">准备工作</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E6%96%87%E4%BB%B6"><span class="top-box-text">下载安装文件</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="top-box-text">安装依赖</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="top-box-text">创建用户</span></a></li></ol></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E7%BC%96%E8%AF%91%E5%B9%B6%E5%AE%89%E8%A3%85"><span class="top-box-text">编译并安装</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E9%85%8D%E7%BD%AE"><span class="top-box-text">配置</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="top-box-text">配置环境变量</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#nginx-%E9%85%8D%E7%BD%AE-php"><span class="top-box-text">nginx 配置 php</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#nginx-php-%E5%A4%9A%E7%89%88%E6%9C%AC%E5%85%B1%E5%AD%98"><span class="top-box-text">nginx php 多版本共存</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF"><span class="top-box-text">开机自启</span></a></li></ol></li></ol></div></div></div><div class="next-post"><a class="purple-link" href="/mysql-master-slave/"><h3 class="post-title"> 下一篇：MySQL 主从复制实现原理</h3></a></div></div><div id="gitalk-container"></div><footer><div class="site-footer"><div class="social-container"><a href="https://github.com/f-dong" target="_blank"><i class="fab fa-github"></i></a></div> Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="https://github.com/f-dong/hexo-theme-minimalism" target="_blank">Theme</a> | <a class="icp" href="https://beian.miit.gov.cn" target="_blank">豫ICP备2022011962号</a> | <a class="icp" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41010402002848" target="_blank">豫公网安备41010402002848号</a></div></footer></div><script src="/js/jquery.min.js"></script><script src="/js/jquery.fancybox.min.js"></script><script src="/js/main.js"></script><script src="/js/gitalk.min.js"></script><script>var gitalk=new Gitalk({clientID:"eaa8ec37487184406145",clientSecret:"77f9955d0267c1331df7cc706cfa385d2befb9c6",repo:"blog",owner:"f-dong",admin:["f-dong"],id:location.pathname.slice(1,location.pathname.lastIndexOf("/")).substring(0,49),distractionFreeMode:!1,createIssueManually:!0});gitalk.render("gitalk-container")</script></body></html>