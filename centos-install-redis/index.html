<!DOCTYPE html><html lang="zh-CN"><head><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("use-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><meta charset="utf-8"><title>Centos 编译安装 redis 以及基础配置</title><meta name="keywords" content="redis,redis 安装,linux,服务器搭建,redis 编译安装,redis配置,php配置redis,redis下载,redis7.0安装"><meta name="description" content="CentOS8编译安装redis7 CentOS7编译安装linux编译安装，本篇文章将采用源代码编译的方式安装redis数据库，并介绍redis的基本设置，以及 php 扩展的安装，采用源码编译方式安装,phpize"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/style/main.css"><link rel="stylesheet" href="/style/jquery.fancybox.min.css"><link rel="stylesheet" href="/style/gitalk.css"><script async src="https://www.googletagmanager.com/gtag/js?id=G-2GM6102E19"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2GM6102E19")</script><link rel="alternate" href="/atom.xml" title="codeover" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="codeover" type="application/rss+xml"></head><body><div id="app" class="main"><div class="site-header-container"><div class="site-header"><div class="left"> <a href="https://www.codeover.cn"><img class="avatar" src="/images/avatar.png" alt="logo" width="32px" height="32px"></a><a href="https://www.codeover.cn"><h1 class="site-title">codeover</h1></a></div><div class="right"><i class="icon menu-switch icon-menu-outline"></i></div></div></div><div class="menu-container" style="height:0;opacity:0"><nav class="menu-list"> <a href="/" class="menu purple-link">首页</a> <a href="/tags/" class="menu purple-link">标签</a> <a href="/categories/" class="menu purple-link">分类</a> <a href="/archives/" class="menu purple-link">归档</a> <a href="/about/" class="menu purple-link">关于</a></nav></div><div class="content-container"><div class="post-detail"><h2 class="post-title">Centos 编译安装 redis 以及基础配置</h2><div class="post-info post-detail-info"><span><i class="icon icon-calendar-outline"></i> 2022-05-26</span><span><i class="icon icon-pricetags-outline"></i> <a href="/tags/linux/">linux ，</a> <a href="/tags/redis/">redis</a></span></div><div class="post-content-wrapper"><div class="post-content"><p><code>Redis</code> 是现在最受欢迎的 <code>NoSQL</code> 数据库之一，Redis 是一个使用 <code>ANSI C</code> 编写的开源、包含多种数据结构、支持网络、基于内存、可选持久性的键值对存储数据库.</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="下载安装文件"><a href="#下载安装文件" class="headerlink" title="下载安装文件"></a>下载安装文件</h3><p>保险起见使用 memcached 官网下载：<a target="_blank" rel="noopener" href="https://redis.io/download/">https://redis.io/download/</a><br>使用官网下载速度较慢，但是安全性有保障，如对安全性没有要求也可百度搜索相关镜像，本文选择官网最新稳定版本 redis 7.0</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">wget https://github.com/redis/redis/archive/7.0.0.tar.gz</span><br><span class="line">tar -zxvf 7.0.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> redis-7.0.0</span><br></pre></td></tr></tbody></table></figure><h2 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 直接安装，PREFIX 即指定安装路径</span></span><br><span class="line">make PREFIX=/www/server/redis install</span><br><span class="line"><span class="comment"># 创建配置文件目录</span></span><br><span class="line"><span class="built_in">mkdir</span> /www/server/redis/etc</span><br><span class="line"><span class="comment"># 复制配置文件</span></span><br><span class="line"><span class="built_in">cp</span> redis.conf /www/server/redis/etc/</span><br></pre></td></tr></tbody></table></figure><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">/www/server/redis/bin/redis-server /www/server/redis/etc/redis.conf</span><br></pre></td></tr></tbody></table></figure><ul><li><code>/www/server/redis/bin/redis-server</code> redis 启动文件</li><li><code>/www/server/redis/etc/redis.conf</code> 指定 redis 配置文件</li></ul><h3 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h3><p>redis 启动时要指定配置文件，下面是各个配置文件的解释：</p><table><thead><tr><th>配置项</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>bind</td><td>127.0.0.1</td><td>绑定地址，如需外网链接需设置为 0.0.0.0</td></tr><tr><td>protected-mode</td><td>yes</td><td>开启保护模式</td></tr><tr><td>port</td><td>6379</td><td>监听的端口</td></tr><tr><td>tcp-backlog</td><td>511</td><td>linux 内核 tcp_max_syn_backlog 和 somaxconn 参数调优</td></tr><tr><td>timeout</td><td>0</td><td>设置限制多少秒后关闭连接，默认不关闭</td></tr><tr><td>tcp-keepalive</td><td>300</td><td>开启 TCP 长连接，以防连接被弃用</td></tr><tr><td>daemonize</td><td>no</td><td>是否开启守护进程</td></tr><tr><td>supervised</td><td>auto</td><td>supervised 相关配置</td></tr><tr><td>pidfile</td><td>~</td><td>pid 文件目录，用于记录当前正运行的 pid</td></tr><tr><td>loglevel</td><td>notice</td><td>指定日志级别，可选 debug、verbose、notice、warning</td></tr><tr><td>logfile</td><td>“”</td><td>指定 redis 日志文件路径，默认不保存日志</td></tr><tr><td>databases</td><td>16</td><td>设置数据库的数量，即 DB 数量</td></tr><tr><td>always-show-logo</td><td>yes</td><td>是否显示 redis 的 logo</td></tr></tbody></table><h3 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h3><ol><li>开启 RDB 持久化，修改 redis 配置文件，新增或修改 <code>save</code>，语法如下：<br><code>save &lt;seconds&gt; &lt;changes&gt;</code><br><code>save 900 1</code>: 就是 900 秒有一次更改就做一次 rdb 快照到磁盘<br>可以注释 save 行或设置 <code>save ""</code> 来禁用，下面是默认值：</li></ol><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">save 900 1 <span class="comment"># 900 秒内有 1 次写入触发</span></span><br><span class="line">save 300 10 <span class="comment"># 300 秒内有 10 次写入触发</span></span><br><span class="line">save 60 10000 <span class="comment"># 60 秒内有 10000 次写入触发</span></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>失败策略</li></ol><p><code>stop-writes-on-bgsave-error yes</code><br>默认情况下，如果 rdb 快照功能开启且最后一次的 rdb 快照创建失败时，redis 会拒绝所有写请求，这是一种强硬手段来告知用户持久化功能不正常，否则可能没人会知道当前出了大问题，如果后台保存成功后，redis 会自动允许写请求，而不需特殊操作。不过这种设定在生产环境中似乎并不合理，你可以设置一些监控来发现这些异常，然后禁用此功能，这样 redis 在持久化失败后依然可以处理写请求，以减少对线上项目产生影响</p><ol start="3"><li>其他配置项</li></ol><ul><li><code>rdbcompression yes</code>，使用 LZF 算法对 rdb 文件进行压缩，当然也会消耗一些 cpu，可设置为 no 减少 cpu 占用</li><li><code>rdbchecksum yes</code>，在 rdb 文件末尾设置一个 CRC64 校验码（循环冗余码），起到了一定的纠错作用，但是也会造成一定量的性能损失，可以关闭此功能以获取最大性能，如果rdb文件校验功能关闭，那么系统读取不到检验码时会自动跳过校验。</li><li><code>dbfilename dump.rdb</code>，rdb 文件名</li><li><code>dir ./</code>，redis的工作目录 ，aof 文件，rdb 文件还有 redis cluster 模式下的 node.conf 文件均会创建在这个目录下。</li></ul><h3 id="php-扩展安装"><a href="#php-扩展安装" class="headerlink" title="php 扩展安装"></a>php 扩展安装</h3><p>我们需要使用 php 连接 redis 服务的话，就要安装对应的扩展，一般我们可以选择直接安装 php 扩展，或者使用 composer 安装 <a target="_blank" rel="noopener" href="https://github.com/predis/predis">predis</a>，本文介绍 php 扩展的安装</p><p>pecl 官网：<a target="_blank" rel="noopener" href="https://pecl.php.net/">https://pecl.php.net</a>，在右上角输入 redis 并搜索并进入，复制相应的下载链接</p><p><a target="_blank" rel="noopener" href="http://cdn.codeover.cn/img/image-20220526220912070.png-imageFop" data-fancybox="lightbox" data-caption="扩展安装截图"><img src="http://cdn.codeover.cn/img/image-20220526220912070.png-imageFop" alt="扩展安装截图"></a></p><p>安装命令如下：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 下载</span></span><br><span class="line">wget https://pecl.php.net/get/redis-5.3.7.tgz</span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -zxvf redis-5.3.7.tgz</span><br><span class="line"><span class="built_in">cd</span> redis-5.3.7</span><br><span class="line"><span class="comment"># /www/server/php81 为 PHP 安装路径</span></span><br><span class="line">/www/server/php81/bin/phpize</span><br><span class="line">./configure --with-php-config=/www/server/php81/bin/php-config</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="comment"># 此时屏幕会显示 Installing shared extensions:     /www/server/php81/lib/php/extensions/no-debug-non-zts-20210902/</span></span><br></pre></td></tr></tbody></table></figure><p>修改 php 安装目录下 <code>etc/php.ini</code> 文件中新增一行 <code>extension=memcached</code> ，如图所示：</p><p><a target="_blank" rel="noopener" href="http://cdn.codeover.cn/img/image-20220526221500661.png-imageFop" data-fancybox="lightbox" data-caption="修改PHP.ini图示"><img src="http://cdn.codeover.cn/img/image-20220526221500661.png-imageFop" alt="修改PHP.ini图示"></a></p><p><a target="_blank" rel="noopener" href="http://cdn.codeover.cn/img/image-20220526221546849.png-imageFop" data-fancybox="lightbox" data-caption="安装成功截图"><img src="http://cdn.codeover.cn/img/image-20220526221546849.png-imageFop" alt="安装成功截图"></a></p></div><div class="top-div"><ol class="top-box"><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="top-box-text">准备工作</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E6%96%87%E4%BB%B6"><span class="top-box-text">下载安装文件</span></a></li></ol></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="top-box-text">安装与配置</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%AE%89%E8%A3%85"><span class="top-box-text">安装</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%90%AF%E5%8A%A8"><span class="top-box-text">启动</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="top-box-text">基础配置</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96"><span class="top-box-text">持久化</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#php-%E6%89%A9%E5%B1%95%E5%AE%89%E8%A3%85"><span class="top-box-text">php 扩展安装</span></a></li></ol></li></ol></div></div></div><div class="next-post"><a class="purple-link" href="/centos_install_memcached/"><h3 class="post-title"> 下一篇：Centos 编译安装 memcache 以及基础配置</h3></a></div></div><div id="gitalk-container"></div><footer><div class="site-footer"><div class="social-container"><a href="https://github.com/f-dong" target="_blank"><i class="icon icon-github"></i></a></div> Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="https://github.com/f-dong/hexo-theme-minimalism" target="_blank">Theme</a> | <a class="icp" href="https://beian.miit.gov.cn" target="_blank">豫ICP备2022011962号</a> | <a class="icp" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41010402002848" target="_blank">豫公网安备41010402002848号</a></div></footer></div><script src="/js/jquery.min.js"></script><script src="/js/jquery.fancybox.min.js"></script><script id="hexo-configurations">window.theme_config={image:{lazyload_enable:!1}},window.is_post=!0</script><script src="/js/main.js"></script><script src="/js/gitalk.min.js"></script><script>var gitalk=new Gitalk({clientID:"eaa8ec37487184406145",clientSecret:"77f9955d0267c1331df7cc706cfa385d2befb9c6",repo:"blog",owner:"f-dong",admin:["f-dong"],id:location.pathname.slice(1,location.pathname.lastIndexOf("/")).substring(0,49),distractionFreeMode:!1,createIssueManually:!0});gitalk.render("gitalk-container")</script></body></html>