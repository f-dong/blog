<!DOCTYPE html><html><head><meta charset="utf-8"><title>Centos 编译安装 MySQL 与基础配置</title><meta name="keywords" content="mysql,mysql 安装,linux,服务器搭建,mysql 编译安装,mysql配置"><meta name="description" content="CentOS 8 编译安装 MySQL 8.0 编译安装 MySQL-80 本篇文章将采用源代码编译的方式安装mysql数据库，并介绍mysql的基本设置，本篇文章兼容mysql5.7版本与mysql5.6版本，采用源码编译方式安装"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/style/main.css"><link rel="stylesheet" href="/style/fontawesome.css"><link rel="stylesheet" href="/style/katex.min.css"><link rel="stylesheet" href="/style/gitalk.css"><script async src="https://www.googletagmanager.com/gtag/js?id=G-2GM6102E19"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2GM6102E19")</script><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="codeover" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="codeover" type="application/rss+xml"></head><body><div id="app" class="main"><div class="site-header-container"><div class="site-header"><div class="left"> <a href="https://www.codeover.cn"><img class="avatar" src="/images/avatar.png" alt="" width="32px" height="32px"></a><a href="https://www.codeover.cn"><h1 class="site-title">codeover</h1></a></div><div class="right"><i class="icon menu-switch icon-menu-outline"></i></div></div></div><div class="menu-container" style="height:0;opacity:0"><nav class="menu-list"> <a href="/" class="menu purple-link">首页</a> <a href="/tags/" class="menu purple-link">标签</a> <a href="/categories/" class="menu purple-link">分类</a> <a href="/archives/" class="menu purple-link">归档</a> <a href="/about/" class="menu purple-link">关于</a></nav></div><div class="content-container"><div class="post-detail"><h2 class="post-title">Centos 编译安装 MySQL 与基础配置</h2><div class="post-info post-detail-info"><span><i class="icon-calendar-outline"></i> 2022-05-03</span><span><i class="icon-pricetags-outline"></i> <a href="/tags/linux/">linux ，</a> <a href="/tags/mysql/">mysql</a></span></div><div class="post-content-wrapper"><div class="post-content"><p>MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，目前属于 Oracle 旗下产品。MySQL 最流行的关系型数据库管理系统，在 WEB 应用方面MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件之一。MySQL是一种关联数据库管理系统，关联数据库将数据保存在不同的表中，而不是将所有数据放在一个大仓库内，这样就增加了速度并提高了灵活性。MySQL所使用的 SQL 语言是用于访问数据库的最常用标准化语言。MySQL 软件采用了双授权政策，它分为社区版和商业版，其体积小、速度快、总体拥有成本低，并且开源.</p><h2 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h2><p>MySQL 官网：<a target="_blank" rel="noopener" href="https://www.mysql.com/cn/">https://www.mysql.com/cn/</a><br>mysql-8.0.29源码包：<a target="_blank" rel="noopener" href="https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-boost-8.0.29.tar.gz">https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-boost-8.0.29.tar.gz</a></p><h3 id="获取最新版源码包"><a href="#获取最新版源码包" class="headerlink" title="获取最新版源码包"></a>获取最新版源码包</h3><ol><li>进入 mysql 官网，点击 Downloads，然后选择 <code>MySQL Community (GPL) Downloads »</code>，如图所示<br><img src="https://cdn.codeover.cn/img/63d0f703918fa0ec9836de68369759ee3c6ddbe6.jpg-imageFop" alt="下载截图1"></li><li>选择 <code>MySQL Community Server</code>，如图所示：<br><img src="https://cdn.codeover.cn/img/627136970947543129ff4739.jpg-imageFop" alt="下载截图2"></li><li>分别选择 <code>Source Code</code> 与 <code>All Operating Systems (Generic) (Architecture Independent)</code>，如图所示：<br><img src="https://cdn.codeover.cn/img/62714a88094754312944b987.jpg-imageFop" alt="下载截图3"></li><li>在新窗口中右键点击 <code>No thanks, just start my download.</code> 复制下载链接</li></ol><h3 id="下载并解压"><a href="#下载并解压" class="headerlink" title="下载并解压"></a>下载并解压</h3><p>以当前最新的 mysql 8.0.29 版本为例</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-boost-8.0.29.tar.gz</span><br><span class="line">tar -zxvf mysql-boost-8.0.29.tar.gz</span><br><span class="line">cd mysql-8.0.29</span><br></pre></td></tr></tbody></table></figure><p>因是国外资源下载可能过慢，可在后台下载，如下：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nohup wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-boost-8.0.29.tar.gz &amp; # 后台下载</span><br><span class="line">tail -f wget_log # 查看下载进度</span><br></pre></td></tr></tbody></table></figure><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="1-创建-swap-分区（非必须）"><a href="#1-创建-swap-分区（非必须）" class="headerlink" title="1. 创建 swap 分区（非必须）"></a>1. 创建 swap 分区（非必须）</h3><p>如果你的服务器内存小于 <code>4G</code> ，建议先创建 swap 分区，否则编译过程可能因为内存不足而中断</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">count 一般设置为物理内存的二倍，但最大不要超过2G，示例中设置了 2G</span></span><br><span class="line">dd if=/dev/zero of=/home/swap bs=1024 count=2048000</span><br><span class="line">mkswap /home/swap</span><br><span class="line">swapon /home/swap</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置开机自动挂起</span></span><br><span class="line">vi /etc/fstab</span><br><span class="line">/home/swap swap swap defaults 0 0 # 将这行添加至文件末尾</span><br></pre></td></tr></tbody></table></figure><h3 id="2-安装依赖文件"><a href="#2-安装依赖文件" class="headerlink" title="2. 安装依赖文件"></a>2. 安装依赖文件</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install cmake gcc gcc-c++ perl bison ncurses-devel gcc-toolset-11-gcc gcc-toolset-11-gcc-c++ gcc-toolset-11-binutils libtirpc-devel autoconf -y</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译安装 rpcgen</span></span><br><span class="line">wget https://github.com/thkukuk/rpcsvc-proto/releases/download/v1.4.3/rpcsvc-proto-1.4.3.tar.xz</span><br><span class="line">tar xsf rpcsvc-proto-1.4.3.tar.xz</span><br><span class="line">cd rpcsvc-proto-1.4.3</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></tbody></table></figure><h3 id="3-编译-mysql-并安装"><a href="#3-编译-mysql-并安装" class="headerlink" title="3. 编译 mysql 并安装"></a>3. 编译 mysql 并安装</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmake -DCMAKE_INSTALL_PREFIX=/www/server/mysql -DMYSQL_DATADIR=/www/server/data -DMYSQL_USER=www -DDEFAULT_CHARSET=utf8mb4 -DDEFAULT_COLLATION=utf8mb4_general_ci -DWITH_DEBUG=0 -DWITH_READLINE=1 -DWITH_EMBEDDED_SERVER=1 -DMYSQL_UNIX_ADDR=/tmp/mysql.sock -DENABLED_LOCAL_INFILE=1 -DFORCE_INSOURCE_BUILD=1 -DWITH_BOOST=boost</span><br><span class="line">make # 需要相当长的时间，建议放后台运行 nohup make &gt;&gt; /root/make.log &amp;</span><br><span class="line">make install</span><br></pre></td></tr></tbody></table></figure><p>其中可根据需要自定义的内容如下</p><table><thead><tr><th>配置项</th><th>说明</th></tr></thead><tbody><tr><td>DCMAKE_INSTALL_PREFIX</td><td>指定 mysql 的安装路径</td></tr><tr><td>DMYSQL_DATADIR</td><td>指定 mysql 数据储存路径(即表数据)</td></tr><tr><td>DMYSQL_USER</td><td>指定运行 mysql 的用户</td></tr><tr><td>DDEFAULT_CHARSET</td><td>指定默认的字符集编码</td></tr><tr><td>DDEFAULT_COLLATION</td><td>指定默认的排序方式</td></tr><tr><td>DWITH_DEBUG</td><td>禁用 debug，1 为启用</td></tr></tbody></table><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h3><p>为了避免第一次启动失败，建议在 mysql 安装目录创建 <code>my.ini</code> 并写入如下默认内容，详细配置说明可参考文章底部</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">client</span>]</span><br><span class="line"><span class="string">port</span> <span class="string">=</span> <span class="number">3306</span></span><br><span class="line"><span class="string">socket</span> <span class="string">=</span> <span class="string">/tmp/mysql.sock</span></span><br><span class="line"></span><br><span class="line">[<span class="string">mysqld</span>]</span><br><span class="line"><span class="string">server-id</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="string">port</span> <span class="string">=</span> <span class="number">3306</span></span><br><span class="line"><span class="comment"># mysql 运行的用户名</span></span><br><span class="line"><span class="string">user</span> <span class="string">=</span> <span class="string">www</span></span><br><span class="line"><span class="comment"># mysql 安装路径</span></span><br><span class="line"><span class="string">basedir</span> <span class="string">=</span> <span class="string">/www/server/mysql</span></span><br><span class="line"><span class="comment"># mysql data存放路径</span></span><br><span class="line"><span class="string">datadir</span> <span class="string">=</span> <span class="string">/www/server/data</span></span><br><span class="line"><span class="string">tmpdir</span>  <span class="string">=</span> <span class="string">/tmp</span></span><br><span class="line"><span class="string">socket</span>  <span class="string">=</span> <span class="string">/tmp/mysql.sock</span></span><br></pre></td></tr></tbody></table></figure><p>如果在编译时自定义了安装路径，需要修改 <code>/www/server/mysql/</code> 与 <code>/www/server/data/</code> 为对应路径</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初始化数据库</span></span><br><span class="line">/www/server/mysql/bin/mysqld --initialize-insecure</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置数据目录权限</span>	</span><br><span class="line">chown -R www /www/server/data/ &amp;&amp; chgrp -R www /www/server/data/</span><br><span class="line">chown -R www /www/server/mysql/ &amp;&amp; chgrp -R www /www/server/mysql/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建软连接</span></span><br><span class="line">ln -s /www/server/mysql/bin/mysql /sbin/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动</span></span><br><span class="line">/www/server/mysql/support-files/mysql.server start</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初始化数据库（根据需要选择即可）</span></span><br><span class="line">/www/server/mysql/bin/mysql_secure_installation</span><br></pre></td></tr></tbody></table></figure><h3 id="my-cnf-配置"><a href="#my-cnf-配置" class="headerlink" title="my.cnf 配置"></a>my.cnf 配置</h3><p>mysql 5.6 以上版本就没有自带 <code>my.cnf</code> 文件了，我们需要手动创建，以下为常用配置说明（照抄自 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/5f39c486561b">https://www.jianshu.com/p/5f39c486561b</a>，略有修改），只取需要修改的部分添加至 <code>my.cnf</code> 即可，其中 <code>innodb_buffer_pool_size</code> 与 <code>log_bin</code> 需要重点关注</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 客户端设置</span></span><br><span class="line">[<span class="string">client</span>]</span><br><span class="line"><span class="string">port</span> <span class="string">=</span> <span class="number">3306</span></span><br><span class="line"><span class="comment"># 默认情况下，socket文件应为/usr/local/mysql/mysql.socket,所以可以ln -s xx  /tmp/mysql.sock</span></span><br><span class="line"><span class="string">socket</span> <span class="string">=</span> <span class="string">/tmp/mysql.sock</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务端设置</span></span><br><span class="line">[<span class="string">mysqld</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################################################</span></span><br><span class="line"><span class="comment"># 基础信息</span></span><br><span class="line"><span class="comment">#Mysql服务的唯一编号 每个mysql服务Id需唯一</span></span><br><span class="line"><span class="string">server-id</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#服务端口号 默认3306</span></span><br><span class="line"><span class="string">port</span> <span class="string">=</span> <span class="number">3306</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动mysql服务进程的用户</span></span><br><span class="line"><span class="string">user</span> <span class="string">=</span> <span class="string">www</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################################################</span></span><br><span class="line"><span class="comment"># 安装目录相关</span></span><br><span class="line"><span class="comment"># mysql安装根目录</span></span><br><span class="line"><span class="string">basedir</span> <span class="string">=</span> <span class="string">/www/server/mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql数据文件所在位置</span></span><br><span class="line"><span class="string">datadir</span> <span class="string">=</span> <span class="string">/www/server/data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 临时目录 比如load data infile会用到,一般都是使用/tmp</span></span><br><span class="line"><span class="string">tmpdir</span>  <span class="string">=</span> <span class="string">/tmp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置socke文件地址</span></span><br><span class="line"><span class="string">socket</span>  <span class="string">=</span> <span class="string">/tmp/mysql.sock</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################################################</span></span><br><span class="line"><span class="comment"># 事务隔离级别，默认为可重复读（REPEATABLE-READ）。（此级别下可能参数很多间隙锁，影响性能，但是修改又影响主从复制及灾难恢复，建议还是修改代码逻辑吧）</span></span><br><span class="line"><span class="comment"># 隔离级别可选项目：READ-UNCOMMITTED  READ-COMMITTED  REPEATABLE-READ  SERIALIZABLE</span></span><br><span class="line"><span class="comment"># transaction_isolation = READ-COMMITTED</span></span><br><span class="line"><span class="string">transaction_isolation</span> <span class="string">=</span> <span class="string">REPEATABLE-READ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################################################</span></span><br><span class="line"><span class="comment"># 数据库引擎与字符集相关设置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql 5.1 之后，默认引擎就是 InnoDB 了</span></span><br><span class="line"><span class="string">default_storage_engine</span> <span class="string">=</span> <span class="string">InnoDB</span></span><br><span class="line"><span class="comment"># 内存临时表默认引擎，默认InnoDB</span></span><br><span class="line"><span class="string">default_tmp_storage_engine</span> <span class="string">=</span> <span class="string">InnoDB</span></span><br><span class="line"><span class="comment"># mysql 5.7 新增特性，磁盘临时表默认引擎，默认 InnoDB</span></span><br><span class="line"><span class="string">internal_tmp_disk_storage_engine</span> <span class="string">=</span> <span class="string">InnoDB</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库默认字符集,主流字符集支持一些特殊表情符号（特殊表情符占用4个字节）</span></span><br><span class="line"><span class="string">character-set-server</span> <span class="string">=</span> <span class="string">utf8mb4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#数据库字符集对应一些排序等规则，注意要和character-set-server对应</span></span><br><span class="line"><span class="string">collation-server</span> <span class="string">=</span> <span class="string">utf8mb4_general_ci</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置client连接mysql时的字符集,防止乱码</span></span><br><span class="line"><span class="comment"># init_connect='SET NAMES utf8'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否对sql语句大小写敏感，默认值为0，1表示不敏感</span></span><br><span class="line"><span class="string">lower_case_table_names</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################################################</span></span><br><span class="line"><span class="comment"># 数据库连接相关设置</span></span><br><span class="line"><span class="comment"># 最大连接数，可设最大值16384，一般考虑根据同时在线人数设置一个比较综合的数字，鉴于该数值增大并不太消耗系统资源，建议直接设10000</span></span><br><span class="line"><span class="comment"># 如果在访问时经常出现Too Many Connections的错误提示，则需要增大该参数值</span></span><br><span class="line"><span class="string">max_connections</span> <span class="string">=</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认值100，最大错误连接数，如果有超出该参数值个数的中断错误连接，则该主机将被禁止连接。如需对该主机进行解禁，执行：FLUSH HOST</span></span><br><span class="line"><span class="comment"># 考虑高并发场景下的容错，建议加大。</span></span><br><span class="line"><span class="string">max_connect_errors</span> <span class="string">=</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL打开的文件描述符限制，默认最小1024;</span></span><br><span class="line"><span class="comment"># 当open_files_limit没有被配置的时候，比较max_connections*5和ulimit -n的值，哪个大用哪个，</span></span><br><span class="line"><span class="comment"># 当open_file_limit被配置的时候，比较open_files_limit和max_connections*5的值，哪个大用哪个。</span></span><br><span class="line"><span class="string">open_files_limit</span> <span class="string">=</span> <span class="number">65535</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：仍然可能出现报错信息Can't create a new thread；此时观察系统cat /proc/mysql进程号/limits，观察进程ulimit限制情况</span></span><br><span class="line"><span class="comment"># 过小的话，考虑修改系统配置表，/etc/security/limits.conf和/etc/security/limits.d/90-nproc.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL默认的wait_timeout  值为8个小时, interactive_timeout参数需要同时配置才能生效</span></span><br><span class="line"><span class="comment"># MySQL连接闲置超过一定时间后(单位：秒，此处为1800秒)将会被强行关闭</span></span><br><span class="line"><span class="string">interactive_timeout</span> <span class="string">=</span> <span class="number">1800</span> </span><br><span class="line"><span class="string">wait_timeout</span> <span class="string">=</span> <span class="number">1800</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 在MySQL暂时停止响应新请求之前的短时间内多少个请求可以被存在堆栈中 </span></span><br><span class="line"><span class="comment"># 官方建议back_log = 50 + (max_connections / 5),封顶数为900</span></span><br><span class="line"><span class="string">back_log</span> <span class="string">=</span> <span class="number">900</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################################################</span></span><br><span class="line"><span class="comment"># 数据库数据交换设置</span></span><br><span class="line"><span class="comment"># 该参数限制服务器端，接受的数据包大小，如果有BLOB子段，建议增大此值，避免写入或者更新出错。有BLOB子段，建议改为1024M</span></span><br><span class="line"><span class="string">max_allowed_packet</span> <span class="string">=</span> <span class="string">128M</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################################################</span></span><br><span class="line"><span class="comment"># 内存，cache与buffer设置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 内存临时表的最大值,默认16M，此处设置成128M</span></span><br><span class="line"><span class="string">tmp_table_size</span> <span class="string">=</span> <span class="string">64M</span></span><br><span class="line"><span class="comment"># 用户创建的内存表的大小，默认16M，往往和tmp_table_size一起设置，限制用户临师表大小。</span></span><br><span class="line"><span class="comment"># 超限的话，MySQL就会自动地把它转化为基于磁盘的MyISAM表，存储在指定的tmpdir目录下，增大IO压力，建议内存大，增大该数值。</span></span><br><span class="line"><span class="string">max_heap_table_size</span> <span class="string">=</span> <span class="string">64M</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 表示这个mysql版本是否支持查询缓存。ps：SHOW STATUS LIKE 'qcache%'，与缓存相关的状态变量。</span></span><br><span class="line"><span class="comment"># have_query_cache</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个系统变量控制着查询缓存工能的开启的关闭，0时表示关闭，1时表示打开，2表示只要select 中明确指定SQL_CACHE才缓存。</span></span><br><span class="line"><span class="comment"># 看业务场景决定是否使用缓存，不使用，下面就不用配置了。</span></span><br><span class="line"><span class="string">query_cache_type</span> <span class="string">=</span> <span class="number">0</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认值1M，优点是查询缓冲可以极大的提高服务器速度, 如果你有大量的相同的查询并且很少修改表。</span></span><br><span class="line"><span class="comment"># 缺点：在你表经常变化的情况下或者如果你的查询原文每次都不同,查询缓冲也许引起性能下降而不是性能提升。</span></span><br><span class="line"><span class="string">query_cache_size</span> <span class="string">=</span> <span class="string">64M</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 只有小于此设定值的结果才会被缓冲，保护查询缓冲,防止一个极大的结果集将其他所有的查询结果都覆盖。</span></span><br><span class="line"><span class="string">query_cache_limit</span> <span class="string">=</span> <span class="string">2M</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个被缓存的结果集要占用的最小内存,默认值4kb，一般不怎么调整。</span></span><br><span class="line"><span class="comment"># 如果Qcache_free_blocks值过大，可能是query_cache_min_res_unit值过大，应该调小些</span></span><br><span class="line"><span class="comment"># query_cache_min_res_unit的估计值：(query_cache_size - Qcache_free_memory) / Qcache_queries_in_cache</span></span><br><span class="line"><span class="string">query_cache_min_res_unit</span> <span class="string">=</span> <span class="string">4kb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在一个事务中binlog为了记录SQL状态所持有的cache大小</span></span><br><span class="line"><span class="comment"># 如果你经常使用大的,多声明的事务,你可以增加此值来获取更大的性能.</span></span><br><span class="line"><span class="comment"># 所有从事务来的状态都将被缓冲在binlog缓冲中然后在提交后一次性写入到binlog中</span></span><br><span class="line"><span class="comment"># 如果事务比此值大, 会使用磁盘上的临时文件来替代.</span></span><br><span class="line"><span class="comment"># 此缓冲在每个连接的事务第一次更新状态时被创建</span></span><br><span class="line"><span class="string">binlog_cache_size</span> <span class="string">=</span> <span class="string">1M</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#*** MyISAM 相关选项</span></span><br><span class="line"><span class="comment"># 指定索引缓冲区的大小, 为MYISAM数据表开启供线程共享的索引缓存,对INNODB引擎无效。相当影响MyISAM的性能。</span></span><br><span class="line"><span class="comment"># 不要将其设置大于你可用内存的30%,因为一部分内存同样被OS用来缓冲行数据</span></span><br><span class="line"><span class="comment"># 甚至在你并不使用MyISAM 表的情况下, 你也需要仍旧设置起 8-64M 内存由于它同样会被内部临时磁盘表使用.</span></span><br><span class="line"><span class="comment"># 默认值 8M，建议值：对于内存在4GB左右的服务器该参数可设置为256M或384M。注意：该参数值设置的过大反而会是服务器整体效率降低！</span></span><br><span class="line"><span class="string">key_buffer_size</span> <span class="string">=</span> <span class="string">64M</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为每个扫描MyISAM的线程分配参数设置的内存大小缓冲区。 </span></span><br><span class="line"><span class="comment"># 默认值128kb，建议值：16G内存建议1M，4G：128kb或者256kb吧</span></span><br><span class="line"><span class="comment"># 注意，该缓冲区是每个连接独占的，所以总缓冲区大小为 128kb*连接数；极端情况128kb*maxconnectiosns，会超级大，所以要考虑日常平均连接数。</span></span><br><span class="line"><span class="comment"># 一般不需要太关心该数值，稍微增大就可以了，</span></span><br><span class="line"><span class="string">read_buffer_size</span> <span class="string">=</span> <span class="number">262144</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持任何存储引擎</span></span><br><span class="line"><span class="comment"># MySQL的随机读缓冲区大小，适当增大，可以提高性能。</span></span><br><span class="line"><span class="comment"># 默认值256kb；建议值：得参考连接数，16G内存，有人推荐8M</span></span><br><span class="line"><span class="comment"># 注意，该缓冲区是每个连接独占的，所以总缓冲区大小为128kb*连接数；极端情况128kb*maxconnectiosns，会超级大，所以要考虑日常平均连接数。</span></span><br><span class="line"><span class="string">read_rnd_buffer_size</span> <span class="string">=</span> <span class="string">1M</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># order by或group by时用到 </span></span><br><span class="line"><span class="comment"># 支持所有引擎，innodb和myisam有自己的innodb_sort_buffer_size和myisam_sort_buffer_size设置</span></span><br><span class="line"><span class="comment"># 默认值256kb；建议值：得参考连接数，16G内存，有人推荐8M.</span></span><br><span class="line"><span class="comment"># 注意，该缓冲区是每个连接独占的，所以总缓冲区大小为 1M*连接数；极端情况1M*maxconnectiosns，会超级大。所以要考虑日常平均连接数。</span></span><br><span class="line"><span class="string">sort_buffer_size</span> <span class="string">=</span> <span class="string">1M</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 此缓冲被使用来优化全联合(full JOINs 不带索引的联合)</span></span><br><span class="line"><span class="comment"># 类似的联合在极大多数情况下有非常糟糕的性能表现,但是将此值设大能够减轻性能影响.</span></span><br><span class="line"><span class="comment"># 通过 “Select_full_join” 状态变量查看全联合的数量</span></span><br><span class="line"><span class="comment"># 注意，该缓冲区是每个连接独占的，所以总缓冲区大小为 1M*连接数；极端情况1M*maxconnectiosns，会超级大。所以要考虑日常平均连接数。</span></span><br><span class="line"><span class="comment"># 默认值256kb;建议值：16G内存，设置8M.</span></span><br><span class="line"><span class="string">join_buffer_size</span> <span class="string">=</span> <span class="string">1M</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓存linux文件描述符信息，加快数据文件打开速度</span></span><br><span class="line"><span class="comment"># 它影响myisam表的打开关闭，但是不影响innodb表的打开关闭。</span></span><br><span class="line"><span class="comment"># 默认值2000，建议值：根据状态变量Opened_tables去设定</span></span><br><span class="line"><span class="string">table_open_cache</span> <span class="string">=</span> <span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓存表定义的相关信息，加快读取表信息速度</span></span><br><span class="line"><span class="comment"># 默认值1400，最大值2000，建议值：基本不改。</span></span><br><span class="line"><span class="string">table_definition_cache</span> <span class="string">=</span> <span class="number">1400</span></span><br><span class="line"><span class="comment"># 该参数是myssql 5.6后引入的，目的是提高并发。</span></span><br><span class="line"><span class="comment"># 默认值1，建议值：cpu核数，并且&lt;=16</span></span><br><span class="line"><span class="string">table_open_cache_instances</span> <span class="string">=</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当客户端断开之后，服务器处理此客户的线程将会缓存起来以响应下一个客户而不是销毁。可重用，减小了系统开销。</span></span><br><span class="line"><span class="comment"># 默认值为9，建议值：两种取值方式，方式一，根据物理内存，1G  —&gt; 8；2G  —&gt; 16； 3G  —&gt; 32； &gt;3G  —&gt; 64；</span></span><br><span class="line"><span class="comment"># 方式二，根据show status like  'threads%'，查看Threads_connected值。</span></span><br><span class="line"><span class="string">thread_cache_size</span> <span class="string">=</span> <span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认值256k,建议值：16/32G内存，512kb，其他一般不改变，如果报错：Thread stack overrun，就增大看看,</span></span><br><span class="line"><span class="comment"># 注意，每个线程分配内存空间，所以总内存空间。。。你懂得。</span></span><br><span class="line"><span class="string">thread_stack</span> <span class="string">=</span> <span class="string">512k</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################################################</span></span><br><span class="line"><span class="comment"># 日志文件相关设置，一般只开启三种日志，错误日志，慢查询日志，二进制日志。普通查询日志不开启。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 普通查询日志，默认值off，不开启</span></span><br><span class="line"><span class="string">general_log</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="comment"># 普通查询日志存放地址</span></span><br><span class="line"><span class="string">general_log_file</span> <span class="string">=</span> <span class="string">/usr/local/mysql-5.7.21/log/mysql-general.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局动态变量，默认3，范围：1～3</span></span><br><span class="line"><span class="comment"># 表示错误日志记录的信息，1：只记录 error 信息；2：记录 error 和 warnings 信息；3：记录 error、warnings 和普通的 notes 信息。</span></span><br><span class="line"><span class="string">log_error_verbosity</span> <span class="string">=</span> <span class="number">2</span></span><br><span class="line"><span class="comment"># 错误日志文件地址</span></span><br><span class="line"><span class="string">log_error</span> <span class="string">=</span> <span class="string">/usr/local/mysql-5.7.21/log/mysql-error.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启慢查询</span></span><br><span class="line"><span class="string">slow_query_log</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启慢查询时间，此处为 30 秒，达到此值才记录数据</span></span><br><span class="line"><span class="string">long_query_time</span> <span class="string">=</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检索行数达到此数值，才记录慢查询日志中</span></span><br><span class="line"><span class="string">min_examined_row_limit</span> <span class="string">=</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql 5.6.5新增，用来表示每分钟允许记录到 slow log 的且未使用索引的 SQL 语句次数，默认值为 0，不限制。</span></span><br><span class="line"><span class="string">log_throttle_queries_not_using_indexes</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 慢查询日志文件地址</span></span><br><span class="line"><span class="string">slow_query_log_file</span> <span class="string">=</span> <span class="string">/www/wwwlogs/mysql/mysql-slow.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启记录没有使用索引查询语句</span></span><br><span class="line"><span class="string">log-queries-not-using-indexes</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启二进制日志</span></span><br><span class="line"><span class="string">log_bin</span> <span class="string">=</span> <span class="string">/www/wwwlogs/mysql/mysql-bin.log</span></span><br><span class="line"><span class="comment"># mysql 清除过期日志的时间，默认值 0，不自动清理，而是使用滚动循环的方式。</span></span><br><span class="line"><span class="string">expire_logs_days</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="comment"># 如果二进制日志写入的内容超出给定值，日志就会发生滚动。你不能将该变量设置为大于 1GB 或小于 4096 字节。 默认值是 1GB。</span></span><br><span class="line"><span class="string">max_binlog_size</span> <span class="string">=</span> <span class="string">1000M</span></span><br><span class="line"><span class="comment"># binlog 的格式也有三种：STATEMENT，ROW，MIXED。mysql 5.7.7后，默认值从 MIXED 改为 ROW</span></span><br><span class="line"><span class="comment"># 关于 binlog 日志格式问题，请查阅网络资料</span></span><br><span class="line"><span class="string">binlog_format</span> <span class="string">=</span> <span class="string">row</span></span><br><span class="line"><span class="comment"># 默认值N=1，使binlog在每N次binlog写入后与硬盘同步，ps：1最慢</span></span><br><span class="line"><span class="comment"># sync_binlog = 1 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################################################</span></span><br><span class="line"><span class="comment"># innodb选项</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：该参数可以提升扩展性和刷脏页性能。</span></span><br><span class="line"><span class="comment"># 默认值1，建议值：4-8；并且必须小于innodb_buffer_pool_instances</span></span><br><span class="line"><span class="string">innodb_page_cleaners</span> <span class="string">=</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：一般8k和16k中选择，8k的话，cpu消耗小些，selcet效率高一点，一般不用改</span></span><br><span class="line"><span class="comment"># 默认值：16k；建议值：不改，</span></span><br><span class="line"><span class="string">innodb_page_size</span> <span class="string">=</span> <span class="number">16384</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：InnoDB使用一个缓冲池来保存索引和原始数据, 不像MyISAM.这里你设置越大,你在存取表里面数据时所需要的磁盘I/O越少.</span></span><br><span class="line"><span class="comment"># 在一个独立使用的数据库服务器上,你可以设置这个变量到服务器物理内存大小的60%-80%</span></span><br><span class="line"><span class="comment"># 注意别设置的过大，会导致 system 的 swap 空间被占用，导致操作系统变慢，从而减低 sql 查询的效率</span></span><br><span class="line"><span class="comment"># 默认值：128M，建议值：物理内存的 60%-80%</span></span><br><span class="line"><span class="string">innodb_buffer_pool_size</span> <span class="string">=</span> <span class="string">512M</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明:只有当设置 innodb_buffer_pool_size 值大于1G时才有意义，小于1G，instances默认为1，大于1G，instances默认为8</span></span><br><span class="line"><span class="comment"># 但是网络上有评价，最佳性能，每个实例至少1G大小。</span></span><br><span class="line"><span class="comment"># 默认值：1或8，建议值：innodb_buffer_pool_size/innodb_buffer_pool_instances &gt;= 1G</span></span><br><span class="line"><span class="string">innodb_buffer_pool_instances</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：mysql 5.7 新特性，defines the chunk size for online InnoDB buffer pool resizing operations.</span></span><br><span class="line"><span class="comment"># 实际缓冲区大小必须为innodb_buffer_pool_chunk_size*innodb_buffer_pool_instances*倍数，取略大于innodb_buffer_pool_size</span></span><br><span class="line"><span class="comment"># 默认值128M，建议值：默认值就好，乱改反而容易出问题，它会影响实际buffer pool大小。</span></span><br><span class="line"><span class="string">innodb_buffer_pool_chunk_size</span> <span class="string">=</span> <span class="string">128M</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 在启动时把热数据加载到内存。默认值为on，不修改</span></span><br><span class="line"><span class="string">innodb_buffer_pool_load_at_startup</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># 在关闭时把热数据dump到本地磁盘。默认值为on，不修改</span></span><br><span class="line"><span class="string">innodb_buffer_pool_dump_at_shutdown</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：影响Innodb缓冲区的刷新算法，建议从小到大配置，直到zero free pages；innodb_lru_scan_depth * innodb_buffer_pool_instances defines the amount of work performed by the page cleaner thread each second.</span></span><br><span class="line"><span class="comment"># 默认值1024，建议值: 未知</span></span><br><span class="line"><span class="string">innodb_lru_scan_depth</span> <span class="string">=</span> <span class="number">1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：事务等待获取资源等待的最长时间，单位为秒，看具体业务情况，一般默认值就好</span></span><br><span class="line"><span class="comment"># 默认值：50，建议值：看业务。</span></span><br><span class="line"><span class="string">innodb_lock_wait_timeout</span> <span class="string">=</span> <span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：设置了Mysql后台任务（例如页刷新和merge dadta from buffer pool）每秒io操作的上限。</span></span><br><span class="line"><span class="comment"># 默认值：200，建议值：方法一，单盘sata设100，sas10，raid10设200，ssd设2000，fushion-io设50000；方法二，通过测试工具获得磁盘io性能后，设置IOPS数值/2。</span></span><br><span class="line"><span class="string">innodb_io_capacity</span> <span class="string">=</span> <span class="number">2000</span></span><br><span class="line"><span class="comment"># 说明：该参数是所有缓冲区线程io操作的总上限。</span></span><br><span class="line"><span class="comment"># 默认值：innodb_io_capacity的两倍。建议值：例如用iometer测试后的iops数值就好</span></span><br><span class="line"><span class="string">innodb_io_capacity_max</span> <span class="string">=</span> <span class="number">4000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：控制着innodb数据文件及redo log的打开、刷写模式，三种模式：fdatasync(默认)，O_DSYNC，O_DIRECT</span></span><br><span class="line"><span class="comment"># fdatasync：数据文件，buffer pool-&gt;os buffer-&gt;磁盘；日志文件，buffer pool-&gt;os buffer-&gt;磁盘；</span></span><br><span class="line"><span class="comment"># O_DSYNC：  数据文件，buffer pool-&gt;os buffer-&gt;磁盘；日志文件，buffer pool-&gt;磁盘；</span></span><br><span class="line"><span class="comment"># O_DIRECT： 数据文件，buffer pool-&gt;磁盘；           日志文件，buffer pool-&gt;os buffer-&gt;磁盘；</span></span><br><span class="line"><span class="comment"># 默认值为空，建议值：使用SAN或者raid，建议用O_DIRECT，不懂测试的话，默认生产上使用O_DIRECT</span></span><br><span class="line"><span class="string">innodb_flush_method</span> <span class="string">=</span> <span class="string">O_DIRECT</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：mysql5.7之后默认开启，意思是，每张表一个独立表空间。</span></span><br><span class="line"><span class="comment"># 默认值1，开启</span></span><br><span class="line"><span class="string">innodb_file_per_table</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：The path where InnoDB creates undo tablespaces.通常等于undo log文件的存放目录。</span></span><br><span class="line"><span class="comment"># 默认值./;自行设置</span></span><br><span class="line"><span class="string">innodb_undo_directory</span> <span class="string">=</span> <span class="string">/usr/local/mysql-5.7.21/log</span></span><br><span class="line"><span class="comment"># 说明：The number of undo tablespaces used by InnoDB.等于undo log文件数量。5.7.21后开始弃用</span></span><br><span class="line"><span class="comment"># 默认值为0，建议默认值就好，不用调整了。</span></span><br><span class="line"><span class="string">innodb_undo_tablespaces</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="comment"># 说明：定义undo使用的回滚段数量。5.7.19后弃用</span></span><br><span class="line"><span class="comment"># 默认值128，建议不动，以后弃用了。</span></span><br><span class="line"><span class="string">innodb_undo_logs</span> <span class="string">=</span> <span class="number">128</span></span><br><span class="line"><span class="comment"># 说明：5.7.5 后开始使用，在线收缩 undo log 使用的空间。</span></span><br><span class="line"><span class="comment"># 默认值：关闭，建议值：开启</span></span><br><span class="line"><span class="string">innodb_undo_log_truncate</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># 说明：结合innodb_undo_log_truncate，实现undo空间收缩功能</span></span><br><span class="line"><span class="comment"># 默认值：1G，建议值，不改。</span></span><br><span class="line"><span class="string">innodb_max_undo_log_size</span> <span class="string">=</span> <span class="string">1G</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：重作日志文件的存放目录</span></span><br><span class="line"><span class="string">innodb_log_group_home_dir</span> <span class="string">=</span> <span class="string">/usr/local/mysql-5.7.21/log</span></span><br><span class="line"><span class="comment"># 说明：日志文件的大小</span></span><br><span class="line"><span class="comment"># 默认值:48M,建议值：根据你系统的磁盘空间和日志增长情况调整大小</span></span><br><span class="line"><span class="string">innodb_log_file_size</span> <span class="string">=</span> <span class="string">128M</span></span><br><span class="line"><span class="comment"># 说明：日志组中的文件数量，mysql以循环方式写入日志</span></span><br><span class="line"><span class="comment"># 默认值2，建议值：根据你系统的磁盘空间和日志增长情况调整大小</span></span><br><span class="line"><span class="string">innodb_log_files_in_group</span> <span class="string">=</span> <span class="number">3</span></span><br><span class="line"><span class="comment"># 此参数确定些日志文件所用的内存大小，以M为单位。缓冲区更大能提高性能，但意外的故障将会丢失数据。MySQL开发人员建议设置为1－8M之间</span></span><br><span class="line"><span class="string">innodb_log_buffer_size</span> <span class="string">=</span> <span class="string">16M</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：可以控制log从系统buffer刷入磁盘文件的刷新频率，增大可减轻系统负荷</span></span><br><span class="line"><span class="comment"># 默认值是1；建议值不改。系统性能一般够用。</span></span><br><span class="line"><span class="string">innodb_flush_log_at_timeout</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># 说明：参数可设为0，1，2；</span></span><br><span class="line"><span class="comment"># 参数0：表示每秒将log buffer内容刷新到系统buffer中，再调用系统flush操作写入磁盘文件。</span></span><br><span class="line"><span class="comment"># 参数1：表示每次事物提交，将log buffer内容刷新到系统buffer中，再调用系统flush操作写入磁盘文件。</span></span><br><span class="line"><span class="comment"># 参数2：表示每次事物提交，将log buffer内容刷新到系统buffer中，隔1秒后再调用系统flush操作写入磁盘文件。</span></span><br><span class="line"><span class="string">innodb_flush_log_at_trx_commit</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：限制Innodb能打开的表的数据，如果库里的表特别多的情况，请增加这个。</span></span><br><span class="line"><span class="comment"># 值默认是2000，建议值：参考数据库表总数再进行调整，一般够用不用调整。</span></span><br><span class="line"><span class="string">innodb_open_files</span> <span class="string">=</span> <span class="number">8192</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># innodb处理io读写的后台并发线程数量，根据cpu核来确认，取值范围：1-64</span></span><br><span class="line"><span class="comment"># 默认值：4，建议值：与逻辑cpu数量的一半保持一致。</span></span><br><span class="line"><span class="string">innodb_read_io_threads</span> <span class="string">=</span> <span class="number">4</span></span><br><span class="line"><span class="string">innodb_write_io_threads</span> <span class="string">=</span> <span class="number">4</span></span><br><span class="line"><span class="comment"># 默认设置为 0,表示不限制并发数，这里推荐设置为0，更好去发挥 CPU 多核处理能力，提高并发量</span></span><br><span class="line"><span class="string">innodb_thread_concurrency</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="comment"># 默认值为 4，建议不变。InnoDB中的清除操作是一类定期回收无用数据的操作。mysql 5.5 之后，支持多线程清除操作。</span></span><br><span class="line"><span class="string">innodb_purge_threads</span> <span class="string">=</span> <span class="number">4</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：mysql缓冲区分为new blocks和old blocks；此参数表示old blocks占比；</span></span><br><span class="line"><span class="comment"># 默认值：37，建议值，一般不动</span></span><br><span class="line"><span class="string">innodb_old_blocks_pct</span> <span class="string">=</span> <span class="number">37</span></span><br><span class="line"><span class="comment"># 说明：新数据被载入缓冲池，进入old pages链区，当1秒后再次访问，则提升进入new pages链区。</span></span><br><span class="line"><span class="comment"># 默认值：1000</span></span><br><span class="line"><span class="string">innodb_old_blocks_time=1000</span></span><br><span class="line"><span class="comment"># 说明：开启异步io，可以提高并发性，默认开启。</span></span><br><span class="line"><span class="comment"># 默认值为1，建议不动</span></span><br><span class="line"><span class="string">innodb_use_native_aio</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：默认为空，使用data目录，一般不改。</span></span><br><span class="line"><span class="string">innodb_data_home_dir=/usr/local/mysql-5.7.21/data</span></span><br><span class="line"><span class="comment"># 说明：Defines the name, size, and attributes of InnoDB system tablespace data files.</span></span><br><span class="line"><span class="comment"># 默认值，不指定，默认为ibdata1:12M:autoextend</span></span><br><span class="line"><span class="string">innodb_data_file_path</span> <span class="string">=</span> <span class="string">ibdata1:12M:autoextend</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明:设置了InnoDB存储引擎用来存放数据字典信息以及一些内部数据结构的内存空间大小,除非你的数据对象及其多，否则一般默认不改。</span></span><br><span class="line"><span class="comment"># innodb_additional_mem_pool_size = 16M</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：The crash recovery mode。只有紧急情况需要恢复数据的时候，才改为大于1-6之间数值，含义查下官网。</span></span><br><span class="line"><span class="comment"># 默认值为0；</span></span><br><span class="line"><span class="comment">#innodb_force_recovery = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################################################</span></span><br><span class="line"><span class="comment"># 其他。。。。</span></span><br><span class="line"><span class="comment"># 参考http://www.kuqin.com/database/20120815/328905.html</span></span><br><span class="line"><span class="comment"># skip-external-locking</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁止MySQL对外部连接进行DNS解析，使用这一选项可以消除MySQL进行DNS解析的时间。</span></span><br><span class="line"><span class="comment"># 缺点：所有远程主机连接授权都要使用IP地址方式，因为只认得ip地址了。</span></span><br><span class="line"><span class="comment"># skip_name_resolve = 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认值为off,timestamp列会自动更新为当前时间，设置为on|1，timestamp列的值就要显式更新</span></span><br><span class="line"><span class="string">explicit_defaults_for_timestamp</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[<span class="string">mysqldump</span>]</span><br><span class="line"><span class="comment"># quick选项强制 mysqldump 从服务器查询取得记录直接输出而不是取得所有记录后将它们缓存到内存中</span></span><br><span class="line"><span class="string">quick</span></span><br><span class="line"><span class="string">max_allowed_packet</span> <span class="string">=</span> <span class="string">16M</span></span><br><span class="line"></span><br><span class="line">[<span class="string">mysql</span>]</span><br><span class="line"><span class="comment"># mysql命令行工具不使用自动补全功能，建议改为 no-auto-rehash</span></span><br><span class="line"><span class="string">auto-rehash</span></span><br><span class="line"><span class="string">socket</span> <span class="string">=</span> <span class="string">/tmp/mysql.sock</span></span><br></pre></td></tr></tbody></table></figure></div><div class="top-div"><ol class="top-box"><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%8C%85"><span class="top-box-text">下载安装包</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E8%8E%B7%E5%8F%96%E6%9C%80%E6%96%B0%E7%89%88%E6%BA%90%E7%A0%81%E5%8C%85"><span class="top-box-text">获取最新版源码包</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E4%B8%8B%E8%BD%BD%E5%B9%B6%E8%A7%A3%E5%8E%8B"><span class="top-box-text">下载并解压</span></a></li></ol></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E5%AE%89%E8%A3%85"><span class="top-box-text">安装</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#1-%E5%88%9B%E5%BB%BA-swap-%E5%88%86%E5%8C%BA%EF%BC%88%E9%9D%9E%E5%BF%85%E9%A1%BB%EF%BC%89"><span class="top-box-text">1. 创建 swap 分区（非必须）</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#2-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E6%96%87%E4%BB%B6"><span class="top-box-text">2. 安装依赖文件</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#3-%E7%BC%96%E8%AF%91-mysql-%E5%B9%B6%E5%AE%89%E8%A3%85"><span class="top-box-text">3. 编译 mysql 并安装</span></a></li></ol></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E4%BD%BF%E7%94%A8"><span class="top-box-text">使用</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="top-box-text">初始化数据库</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#my-cnf-%E9%85%8D%E7%BD%AE"><span class="top-box-text">my.cnf 配置</span></a></li></ol></li></ol></div></div></div><div class="next-post"><a class="purple-link" href="/nginx-balancing/"><h3 class="post-title"> 下一篇：Nginx 负载均衡配置</h3></a></div></div><div id="gitalk-container"></div><footer><div class="site-footer"><div class="social-container"><a href="https://github.com/f-dong" target="_blank"><i class="fab fa-github"></i></a></div> Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="https://github.com/f-dong/hexo-theme-minimalism" target="_blank">Theme</a> | <a class="icp" href="https://beian.miit.gov.cn" target="_blank">豫ICP备2022011962号</a></div></footer></div><script src="/js/jquery.min.js"></script><script>$(".menu-switch").click(function(){if($(this).hasClass("icon-menu-outline"))$(this).removeClass(" icon-menu-outline ").addClass("icon-close-outline"),$(".menu-container").css("opacity","1").css("height","auto");else{$(this).addClass(" icon-menu-outline ").removeClass("icon-close-outline"),$(".menu-container").css("opacity","0");var s=$(this);setTimeout(function(){s.hasClass("icon-menu-outline")&&$(".menu-container").css("height","0")},600)}})</script><script src="/js/gitalk.min.js"></script><script>var gitalk=new Gitalk({clientID:"eaa8ec37487184406145",clientSecret:"77f9955d0267c1331df7cc706cfa385d2befb9c6",repo:"blog",owner:"f-dong",admin:["f-dong"],id:location.pathname.slice(1,location.pathname.lastIndexOf("/")).substring(0,49),distractionFreeMode:!1});gitalk.render("gitalk-container")</script><script src="/js/gitalk.min.js"></script><script>var gitalk=new Gitalk({clientID:"eaa8ec37487184406145",clientSecret:"77f9955d0267c1331df7cc706cfa385d2befb9c6",repo:"blog",owner:"f-dong",admin:["f-dong"],id:location.pathname.slice(1,location.pathname.lastIndexOf("/")).substring(0,49),distractionFreeMode:!1});gitalk.render("gitalk-container")</script><script>
        // 代码语言
        $(function () {
          $('code').each(function () {
            var code_language = $(this).attr('class');

            if (!code_language) {
              return true;
            }
            var lang_name = code_language.replace("line-numbers", "").trim().replace("highlight", "").trim().replace("language-", "").trim();

            $(this).attr('data-content-after', lang_name || 'CODE');
          });
          $('.highlight').each(function () {
            var code_language = $(this).attr('class');

            if (!code_language) {
              return true;
            }
            var lang_name = code_language.replace("highlight", "").trim();

            $(this).attr('data-content-after', lang_name || 'CODE');
          });
        });

        let mainNavLinks = document.querySelectorAll(".top-box a");

        window.addEventListener("scroll", event => {
          let fromTop = window.scrollY + 100;

          mainNavLinks.forEach((link, index) => {
            let section = document.getElementById(decodeURI(link.hash).substring(1));
            let nextSection = null
            if (mainNavLinks[index + 1]) {
              nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
            }
            if (section.offsetTop <= fromTop) {
              if (nextSection) {
                if (nextSection.offsetTop > fromTop) {
                  link.classList.add("current");
                } else {
                  link.classList.remove("current");
                }
              } else {
                link.classList.add("current");
              }
            } else {
              link.classList.remove("current");
            }
          });
        });
    </script></body></html>