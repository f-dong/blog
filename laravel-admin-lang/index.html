<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><title>laravel-admin 根据路由自动切换语言包</title><meta name="keywords" content="php,laravel,laravel-admin,本地化,语言包,根据路由切换语言包,laravel使用,laravel技巧,多语言文件"><meta name="description" content="laravel 的本地化功能提供了一种方便的方法来检索各种语言的字符串，本文将使用路由名动态切换需要使用的语言包，实现每个控制器单独翻译文件"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/style/main.css"><link rel="stylesheet" href="/style/fontawesome.css"><link rel="stylesheet" href="/style/jquery.fancybox.min.css"><link rel="stylesheet" href="/style/gitalk.css"><script async src="https://www.googletagmanager.com/gtag/js?id=G-2GM6102E19"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2GM6102E19")</script><link rel="alternate" href="/atom.xml" title="codeover" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="codeover" type="application/rss+xml"></head><body><div id="app" class="main"><div class="site-header-container"><div class="site-header"><div class="left"> <a href="https://www.codeover.cn"><img class="avatar" src="/images/avatar.png" alt="" width="32px" height="32px"></a><a href="https://www.codeover.cn"><h1 class="site-title">codeover</h1></a></div><div class="right"><i class="icon menu-switch icon-menu-outline"></i></div></div></div><div class="menu-container" style="height:0;opacity:0"><nav class="menu-list"> <a href="/" class="menu purple-link">首页</a> <a href="/tags/" class="menu purple-link">标签</a> <a href="/categories/" class="menu purple-link">分类</a> <a href="/archives/" class="menu purple-link">归档</a> <a href="/about/" class="menu purple-link">关于</a></nav></div><div class="content-container"><div class="post-detail"><h2 class="post-title">laravel-admin 根据路由自动切换语言包</h2><div class="post-info post-detail-info"><span><i class="icon-calendar-outline"></i> 2022-06-30</span><span><i class="icon-pricetags-outline"></i> <a href="/tags/php/">php ，</a> <a href="/tags/laravel/">laravel ，</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E9%80%9F%E8%AE%B0/">代码速记</a></span></div><div class="post-content-wrapper"><div class="post-content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>laravel 的本地化功能提供了一种方便的方法来检索各种语言的字符串，从而可以轻松的在应用内支持多种语言，我们一般将语言文件存放在 <code>lang</code> 目录下，随后使用 <a target="_blank" rel="noopener" href="https://learnku.com/docs/laravel/9.x/localization/12232#3c3f33"><code>__</code></a> 辅助函数从语言文件检索翻译字符串。同样，laravel-admin 也使用这种方式来实现本地化，但这个目录是公共翻译路径，如果同一个键在不同控制器翻译的结果不一致<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="例如 `__('Name')` 在 `UsersController` 中需要翻译为 `用户姓名`，而在 `TagsController` 中需要翻译为 `标签名`，或者同一翻译键在前台用户端与后台翻译结果不同
">[1]</span></a></sup>情况，将翻译内容直接放置在 <code>lang</code> 就会造成一定的歧义<sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="一般使用 laravel-admin 时，一般使用 `php artisan admin:make UsersController --model=App\\Models\\User` 来生成控制器，该命令默认会将数据库字段名作为翻译键">[2]</span></a></sup></p><p>为了解决此问题，本文介绍根据控制器来区分不同的翻译文件</p><h2 id="代码部分"><a href="#代码部分" class="headerlink" title="代码部分"></a>代码部分</h2><p><code>app\Admin\Middleware</code></p><figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Admin</span>\<span class="title class_">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Cookie</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">App</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Str</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SwitchLanguage</span></span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据路由自动切换语言包</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Illuminate\Http\Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Closure $next</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">Request <span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="variable">$multi_language</span> = <span class="title function_ invoke__">config</span>(<span class="string">'admin.multi_language'</span>);</span><br><span class="line">        <span class="variable">$languages</span> = <span class="variable">$multi_language</span>[<span class="string">'languages'</span>];</span><br><span class="line">        <span class="variable">$current</span> = <span class="variable">$multi_language</span>[<span class="string">'default'</span>];</span><br><span class="line">        <span class="variable">$cookie_name</span> = <span class="variable">$multi_language</span>[<span class="string">'cookie_name'</span>];</span><br><span class="line">        <span class="variable">$cookie_language</span> = <span class="title class_">Cookie</span>::<span class="title function_ invoke__">get</span>(<span class="variable">$cookie_name</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$cookie_language</span> || !<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$cookie_language</span>, <span class="variable">$languages</span>)) {</span><br><span class="line">            <span class="variable">$cookie_language</span> = <span class="variable">$current</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="title class_">App</span>::<span class="title function_ invoke__">setLocale</span>(<span class="variable">$cookie_language</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$controller_name</span> = <span class="title function_ invoke__">get_class</span>(<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">route</span>()-&gt;controller);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$controller_name</span>, -<span class="number">10</span>)) === <span class="string">'controller'</span> <span class="keyword">and</span> <span class="title class_">Str</span>::<span class="title function_ invoke__">startsWith</span>(<span class="variable">$controller_name</span>, <span class="string">'App\\Admin\\Controllers\\'</span>)) {</span><br><span class="line">            <span class="variable">$controller_name</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">'App\\Admin\\Controllers\\'</span>, <span class="string">''</span>, <span class="variable">$controller_name</span>);</span><br><span class="line">            <span class="variable">$controller_name</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$controller_name</span>, <span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$controller_name</span>) - <span class="number">10</span>);</span><br><span class="line">            <span class="variable">$translator_path</span> = <span class="title function_ invoke__">config</span>(<span class="string">'admin.multi_language.lang_directory'</span>) . <span class="title function_ invoke__">str_replace</span>(<span class="string">'\\'</span>, DIRECTORY_SEPARATOR, <span class="variable">$controller_name</span> . DIRECTORY_SEPARATOR);</span><br><span class="line">            <span class="title function_ invoke__">app</span>(<span class="string">'translator'</span>)-&gt;<span class="title function_ invoke__">addJsonPath</span>(<span class="variable">$translator_path</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><code>config/admin.php</code> 新增如下配置：</p><figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">'multi_language'</span> =&gt; [</span><br><span class="line">    <span class="comment">// 指定语言文件目录</span></span><br><span class="line">    <span class="string">'lang_directory'</span> =&gt; <span class="title function_ invoke__">resource_path</span>(<span class="string">'langext'</span>) . DIRECTORY_SEPARATOR,</span><br><span class="line">    <span class="comment">// 支持的语言</span></span><br><span class="line">    <span class="string">'languages'</span> =&gt; [</span><br><span class="line">        <span class="string">'en'</span> =&gt; <span class="string">'English'</span>,</span><br><span class="line">        <span class="string">'zh_CN'</span> =&gt; <span class="string">'简体中文'</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 默认语言</span></span><br><span class="line">    <span class="string">'default'</span> =&gt; <span class="string">'zh_CN'</span>,</span><br><span class="line">    <span class="comment">// cookie键，用于记住用户语言</span></span><br><span class="line">    <span class="string">'cookie_name'</span> =&gt; <span class="string">'backend_locale'</span>,</span><br><span class="line">],</span><br></pre></td></tr></tbody></table></figure><p>在 <code>config/admin.php</code> 中添加该中间件：</p><figure class="highlight diff"><table><tbody><tr><td class="code"><pre><span class="line">'route' =&gt; [</span><br><span class="line"></span><br><span class="line">    'prefix' =&gt; env('ADMIN_ROUTE_PREFIX', 'admin'),</span><br><span class="line"></span><br><span class="line">    'namespace' =&gt; 'App\\Admin\\Controllers',</span><br><span class="line"></span><br><span class="line"><span class="deletion">-   'middleware' =&gt; ['web', 'admin'],</span></span><br><span class="line"><span class="addition">+   'middleware' =&gt; ['web', 'admin', \App\Admin\Middleware\SwitchLanguage::class],</span></span><br><span class="line">],</span><br></pre></td></tr></tbody></table></figure><p>随后在 <code>resources/langext/控制器名/区域名/xxx.json</code> 中新增翻译内容即可，例如给 <code>ProductsController</code> 创建单独翻译文件，则翻译文件路径为 <code>resources/langext/Products/zh_CN/zh_CN.json</code></p><p>注意：如果翻译键值与公共翻译处冲突，则以单独的翻译文件为准。</p><br><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none;padding-left:0;margin-left:40px"><li id="fn:1"><span style="display:inline-block;vertical-align:top;padding-right:10px;margin-left:-40px">1.</span><span style="display:inline-block;vertical-align:top;margin-left:10px">例如 <code>__('Name')</code> 在 <code>UsersController</code> 中需要翻译为 <code>用户姓名</code>，而在 <code>TagsController</code> 中需要翻译为 <code>标签名</code>，或者同一翻译键在前台用户端与后台翻译结果不同 <a href="#fnref:1" rev="footnote">↩</a></span></li><li id="fn:2"><span style="display:inline-block;vertical-align:top;padding-right:10px;margin-left:-40px">2.</span><span style="display:inline-block;vertical-align:top;margin-left:10px">一般使用 laravel-admin 时，一般使用 <code>php artisan admin:make UsersController --model=App\\Models\\User</code> 来生成控制器，该命令默认会将数据库字段名作为翻译键 <a href="#fnref:2" rev="footnote">↩</a></span></li></ol></div></div></div><div class="top-div"><ol class="top-box"><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E8%83%8C%E6%99%AF"><span class="top-box-text">背景</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86"><span class="top-box-text">代码部分</span></a></li></ol></div></div></div><div class="next-post"><a class="purple-link" href="/weichatpayv3byphp7/"><h3 class="post-title"> 下一篇：关于微信支付V3 PHP7.2以下实现方式</h3></a></div></div><div id="gitalk-container"></div><footer><div class="site-footer"><div class="social-container"><a href="https://github.com/f-dong" target="_blank"><i class="fab fa-github"></i></a></div> Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="https://github.com/f-dong/hexo-theme-minimalism" target="_blank">Theme</a> | <a class="icp" href="https://beian.miit.gov.cn" target="_blank">豫ICP备2022011962号</a> | <a class="icp" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41010402002848" target="_blank">豫公网安备41010402002848号</a></div></footer></div><script src="/js/jquery.min.js"></script><script src="/js/jquery.fancybox.min.js"></script><script src="/js/main.js"></script><script src="/js/gitalk.min.js"></script><script>var gitalk=new Gitalk({clientID:"eaa8ec37487184406145",clientSecret:"77f9955d0267c1331df7cc706cfa385d2befb9c6",repo:"blog",owner:"f-dong",admin:["f-dong"],id:location.pathname.slice(1,location.pathname.lastIndexOf("/")).substring(0,49),distractionFreeMode:!1,createIssueManually:!0});gitalk.render("gitalk-container")</script></body></html>