<!DOCTYPE html><html><head><meta charset="utf-8"><title>nginx 使用 gzip 压缩静态资源</title><meta name="keywords" content="Nginx,Nginx 安装,linux,nginx gzip,gzip"><meta name="description" content="为提高网页加载速度，启用gzip缩减资源的大小是非常常见的手段。现代浏览器基本均支持gzip压缩，并会为HTTP请求自动协商此类压缩。"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/style/main.css"><link rel="stylesheet" href="/style/fontawesome.css"><link rel="stylesheet" href="/style/jquery.fancybox.min.css"><link rel="stylesheet" href="/style/gitalk.css"><script async src="https://www.googletagmanager.com/gtag/js?id=G-2GM6102E19"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2GM6102E19")</script><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="codeover" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="codeover" type="application/rss+xml"></head><body><div id="app" class="main"><div class="site-header-container"><div class="site-header"><div class="left"> <a href="https://www.codeover.cn"><img class="avatar" src="/images/avatar.png" alt="" width="32px" height="32px"></a><a href="https://www.codeover.cn"><h1 class="site-title">codeover</h1></a></div><div class="right"><i class="icon menu-switch icon-menu-outline"></i></div></div></div><div class="menu-container" style="height:0;opacity:0"><nav class="menu-list"> <a href="/" class="menu purple-link">首页</a> <a href="/tags/" class="menu purple-link">标签</a> <a href="/categories/" class="menu purple-link">分类</a> <a href="/archives/" class="menu purple-link">归档</a> <a href="/about/" class="menu purple-link">关于</a></nav></div><div class="content-container"><div class="post-detail"><h2 class="post-title">nginx 使用 gzip 压缩静态资源</h2><div class="post-info post-detail-info"><span><i class="icon-calendar-outline"></i> 2022-04-29</span><span><i class="icon-pricetags-outline"></i> <a href="/tags/linux/">linux ，</a> <a href="/tags/Nginx/">Nginx</a></span></div><div class="post-content-wrapper"><div class="post-content"><p>为提高网页加载速度，启用 <code>gzip</code> 缩减资源的大小是非常常见的手段。现代浏览器基本均支持 <code>gzip</code> 压缩，并会为HTTP请求自动协商此类压缩。</p><h2 id="处理过程"><a href="#处理过程" class="headerlink" title="处理过程"></a>处理过程</h2><p>nginx 在接收到浏览器发出的请求之后，会根据请求信息检查浏览器可以接受哪些压缩方法，详情可见下图。</p><p><img src="https://cdn.codeover.cn/img/626ab151239250f7c52e1bde.jpg-imageFop" alt="过程截图"></p><p>浏览器在请求头信息中会追加上上 <code>Accept-Encoding</code> 参数来说明自己支持哪些压缩方式。</p><p>如果服务端压缩了文件，就会在返回头信息增加一个 <code>Content-Encoding</code> ，用来说明数据的压缩方式。</p><p>绝大多数的浏览器都已经支持了 <code>gzip</code>，并且有请求头的验证，所以基本不需要担心兼容相关的问题。</p><p>压缩前后的体积差异，可以在控制台中看到。对于 js、css 文件的压缩率还是比较可观的。</p><p><img src="https://cdn.codeover.cn/img/626ab42c239250f7c535a2a8.png-imageFop" alt="压缩率对比"></p><h2 id="gzip-配置参数"><a href="#gzip-配置参数" class="headerlink" title="gzip 配置参数"></a>gzip 配置参数</h2><table><thead><tr><th>名称</th><th>默认配置</th><th>含义</th></tr></thead><tbody><tr><td>gzip</td><td>gzip off;</td><td>设置是否开启对后端响应的 gzip 压缩，然后返回压缩内容给前端</td></tr><tr><td>xxxxxxxxxx&nbsp;# 启动nginx​# 停止nginx -s stop​# 重启nginx -s quitnginx​# 平滑重启nginx -s reloadshell</td><td>gzip_buffers 32 4k 或16 8k;</td><td>设置用于压缩后端 response 的 buffer 的数量和每个的大小，默认每个 buffer 大小为一个内存页，根据平台不同可能是 4k 或 8k</td></tr><tr><td>gzip_comp_level</td><td>gzip_comp_level 1;</td><td>指定 gzip 压缩的级别，默认为 1，该值可设置的范围是 1-9，数字越大压缩的越好，同时也越占用CPU资源</td></tr><tr><td>gzip_disable</td><td>无</td><td>正则匹配 User-Agent 中的值，匹配上则不进行 gzip</td></tr><tr><td>gzip_min_length</td><td>gzip_min_length 20;</td><td>设定进行 gzip 压缩的阈值，当后端 response 的 Content-Length 大小小于该值则不进行 gzip 压缩</td></tr><tr><td>gzip_http_version</td><td>gzip_http_version 1.1;</td><td>设定进行 gzip 压缩的最小 http 版本</td></tr><tr><td>gzip_proxied</td><td>gzip_proxied off;</td><td>根据 request 或响应的相关 header 的值来决定是否进行 gzip</td></tr><tr><td>gzip_types</td><td>gzip_types text/html;</td><td>指定哪些 mime types 启用 gzip 压缩，默认 text/html</td></tr><tr><td>gzip_vary</td><td>gzip_vary off;</td><td>是否在 response header 中头写入Vary: Accept-Encoding</td></tr><tr><td>gzip_static</td><td>gzip_static off;</td><td>开启之后，接到(静态文件)请求会到 url 相同的路径的文件系统去找扩展名为 “.gz” 的文件，如果存在直接把它发送出去，如果不存在，则进行 gzip 压缩，再发送出去，需要额外编译 http_gzip_static</td></tr></tbody></table><h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p>编辑 <code>nginx.conf</code> 文件</p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> {</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开启 gzip</span></span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="comment"># 1k 以下的文件不压缩（小文件压缩反而会适得其反）</span></span><br><span class="line">    <span class="attribute">gzip_min_length</span> <span class="number">1k</span>;</span><br><span class="line">    <span class="comment"># 压缩级别设置为 2，设置较大数值会消耗较多 cpu 资源</span></span><br><span class="line">    <span class="attribute">gzip_comp_level</span> <span class="number">2</span>;</span><br><span class="line">    <span class="comment"># 参与压缩的文件类型 可在配置文件同级的 mime.types 查看并添加 不建议压缩图片文件</span></span><br><span class="line">    <span class="attribute">gzip_types</span> application/xhtml+xml text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml font/ttf font/otf;</span><br><span class="line">    <span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><div class="top-div"><ol class="top-box"><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E5%A4%84%E7%90%86%E8%BF%87%E7%A8%8B"><span class="top-box-text">处理过程</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#gzip-%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="top-box-text">gzip 配置参数</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E6%A1%88%E4%BE%8B"><span class="top-box-text">案例</span></a></li></ol></div></div></div><div class="next-post"><a class="purple-link" href="/nginx-server-config/"><h3 class="post-title"> 下一篇：Nginx web server 配置</h3></a></div></div><div id="gitalk-container"></div><footer><div class="site-footer"><div class="social-container"><a href="https://github.com/f-dong" target="_blank"><i class="fab fa-github"></i></a></div> Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="https://github.com/f-dong/hexo-theme-minimalism" target="_blank">Theme</a> | <a class="icp" href="https://beian.miit.gov.cn" target="_blank">豫ICP备2022011962号</a> | <a class="icp" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41010402002848" target="_blank">豫公网安备41010402002848号</a></div></footer></div><script src="/js/jquery.min.js"></script><script src="/js/jquery.fancybox.min.js"></script><script src="/js/main.js"></script><script src="/js/gitalk.min.js"></script><script>var gitalk=new Gitalk({clientID:"eaa8ec37487184406145",clientSecret:"77f9955d0267c1331df7cc706cfa385d2befb9c6",repo:"blog",owner:"f-dong",admin:["f-dong"],id:location.pathname.slice(1,location.pathname.lastIndexOf("/")).substring(0,49),distractionFreeMode:!1,createIssueManually:!0});gitalk.render("gitalk-container")</script></body></html>