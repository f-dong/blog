<!DOCTYPE html><html lang="zh-CN"><head><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("use-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><meta charset="utf-8"><title>linux 安装 vsftpd 服务以及配置全攻略</title><meta name="keywords" content="ftp,ftp 安装,vsftpd,服务器搭建,vsftpd 配置,文件传输,filezilla"><meta name="description" content="CentOS8安装vsftpd CentOS7安装 FTP服务器的配置 linux编译安装，本篇文章主要介绍vsftpd的安装与配置，FTP是常用的文件传输协议，yum方式安装"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/style/main.css"><link rel="stylesheet" href="/style/gitalk.min.css"><link rel="stylesheet" href="/style/simple-lightbox.min.css"><link rel="alternate" href="/atom.xml" title="codeover" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="codeover" type="application/rss+xml"></head><body><div id="app" class="main"><div class="site-header-container"><div class="site-header"><div class="left"> <a href="https://www.codeover.cn"><img class="avatar" src="/images/avatar.png" alt="logo" width="32px" height="32px"></a><a href="https://www.codeover.cn"><h1 class="site-title">codeover</h1></a></div><div class="right"><i class="icon menu-switch icon-menu-outline"></i></div></div></div><div class="menu-container" style="height:0;opacity:0"><nav class="menu-list"> <a href="/" class="menu purple-link">首页</a> <a href="/tags/" class="menu purple-link">标签</a> <a href="/categories/" class="menu purple-link">分类</a> <a href="/archives/" class="menu purple-link">归档</a> <a href="/about/" class="menu purple-link">关于</a></nav></div><div class="content-container"><div class="post-detail"><h2 class="post-title">linux 安装 vsftpd 服务以及配置全攻略</h2><div class="post-info post-detail-info"><span><i class="icon icon-calendar-outline"></i> 2022-05-30</span><span><i class="icon icon-pricetags-outline"></i> <a href="/tags/linux/">linux</a></span></div><div class="post-content-wrapper"><div class="post-content"><p>FTP 是 File Transfer Protocol 的简称，用于 Internet 上的控制文件的双向传输。同时，他也是一个应用程序，基于不同的操作系统有不同的 FTP 应用程序，而所有这些应用程序都遵守同一协议传输文件。在 FTP 的使用当中，用户经常遇到两个概念：上传和下载，下载文件就是从远程主机拷贝文件到自己的计算机上，上传文件是指将自己计算机中的文件拷贝至远程主机上。FTP 常用于开发阶段文件上传工具，常用的客户端软件有 <a target="_blank" rel="noopener" href="https://filezilla-project.org/">filezilla</a>、<a target="_blank" rel="noopener" href="https://www.flashfxp.com/">flashfxp</a>、<a target="_blank" rel="noopener" href="https://winscp.net/eng/download.php">winscp</a>、<a target="_blank" rel="noopener" href="https://www.xshell.com/zh/xftp/">xftp</a> 等</p><h2 id="服务端安装"><a href="#服务端安装" class="headerlink" title="服务端安装"></a>服务端安装</h2><p>服务端最常用的软件就是 <a target="_blank" rel="noopener" href="https://security.appspot.com/vsftpd.html">vsftpd</a>，其安装方式也很简单，如下:</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">yum install vsftpd -y <span class="comment"># CentOS</span></span><br><span class="line">apt-get install vsftpd -y <span class="comment"># Ubuntu</span></span><br></pre></td></tr></tbody></table></figure><p>启动与停止命令如下：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">systemctl start vsftpd.service <span class="comment"># 启动</span></span><br><span class="line">systemctl stop vsftpd.service <span class="comment"># 停止</span></span><br><span class="line">systemctl restart vsftpd.service <span class="comment"># 重启</span></span><br></pre></td></tr></tbody></table></figure><p>或者：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">service vsftpd start <span class="comment"># 启动</span></span><br><span class="line">service vsftpd stop <span class="comment"># 停止</span></span><br><span class="line">service vsftpd restart <span class="comment"># 重启</span></span><br></pre></td></tr></tbody></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h3><p>vsftpd 的默认基础配置文件位于 <code>/etc/vsftpd/vsftpd.conf</code>，这个文件是 vsftpd 的核心配置文件，操作修改之前最好先备份，配置文件内容的基础说明：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 是否允许匿名登录 FTP 服务器，默认设置为 NO 表示允许</span></span><br><span class="line"><span class="comment"># 用户可使用用户名 ftp 或 anonymous 进行 ftp 登录，口令为用户的 E-mail 地址。</span></span><br><span class="line"><span class="comment"># 如在内网使用不需要登录可设置为 YES</span></span><br><span class="line"><span class="string">anonymous_enable=NO</span></span><br><span class="line"><span class="comment"># 是否允许本地用户(即 linux 系统中的用户帐号)登录 FTP 服务器，默认设置为 YES 允许</span></span><br><span class="line"><span class="comment"># 本地用户登录后会进入用户主目录，而匿名用户登录后进入匿名用户的下载目录 /var/ftp/pub</span></span><br><span class="line"><span class="comment"># 若只允许匿名用户访问，前面加上#注释掉即可阻止本地用户访问 FTP 服务器</span></span><br><span class="line"><span class="string">local_enable=YES</span></span><br><span class="line"><span class="comment"># 是否允许本地用户对 FTP 服务器文件具有写权限，默认设置为 YES 允许</span></span><br><span class="line"><span class="string">write_enable=YES</span> </span><br><span class="line"><span class="comment"># 掩码，本地用户默认掩码为 077</span></span><br><span class="line"><span class="comment"># 你可以设置本地用户的文件掩码为缺省 022，也可根据个人喜好将其设置为其他值</span></span><br><span class="line"><span class="string">local_umask=022</span></span><br><span class="line"><span class="comment"># 是否允许匿名用户上传文件，须将全局的 write_enable=YES 默认为 NO</span></span><br><span class="line"><span class="comment">#anon_upload_enable=YES</span></span><br><span class="line"><span class="comment"># 是否允许匿名用户创建新文件夹</span></span><br><span class="line"><span class="comment">#anon_mkdir_write_enable=YES </span></span><br><span class="line"><span class="comment"># 是否激活目录欢迎信息功能</span></span><br><span class="line"><span class="comment"># 当用户用 CMD 模式首次访问服务器上某个目录时，FTP 服务器将显示欢迎信息</span></span><br><span class="line"><span class="comment"># 默认情况下，欢迎信息是通过该目录下的 .message 文件获得的</span></span><br><span class="line"><span class="comment"># 此文件保存自定义的欢迎信息，由用户自己建立</span></span><br><span class="line"><span class="string">dirmessage_enable=YES</span></span><br><span class="line"><span class="comment"># 是否让系统自动维护上传和下载的日志文件</span></span><br><span class="line"><span class="comment"># 默认情况该日志文件为 /var/log/vsftpd.log 也可以通过下面的 xferlog_fil e选项对其进行设定</span></span><br><span class="line"><span class="string">xferlog_enable=YES</span></span><br><span class="line"><span class="comment"># 是否设定 FTP 服务器将启用 FTP 数据端口的连接请求</span></span><br><span class="line"><span class="comment"># ftp-data 数据传输，21 为连接控制端口</span></span><br><span class="line"><span class="string">connect_from_port_20=YES</span></span><br><span class="line"><span class="comment"># 设定是否允许改变上传文件的属主，与下面一个设定项配合使用</span></span><br><span class="line"><span class="comment"># 注意，不推荐使用 root 用户上传文件</span></span><br><span class="line"><span class="comment">#chown_uploads=YES</span></span><br><span class="line"><span class="comment"># 设置想要改变的上传文件的属主，如果需要，则输入一个系统用户名</span></span><br><span class="line"><span class="comment"># 可以把上传的文件都改成 root 属主。whoever：任何人</span></span><br><span class="line"><span class="comment">#chown_username=whoever</span></span><br><span class="line"><span class="comment"># 设定系统维护记录 FTP 服务器上传和下载情况的日志文件</span></span><br><span class="line"><span class="comment"># /var/log/vsftpd.log 是默认的，也可以修改为其它</span></span><br><span class="line"><span class="comment">#xferlog_file=/var/log/vsftpd.log</span></span><br><span class="line"><span class="comment"># 是否以标准 xferlog 的格式书写传输日志文件</span></span><br><span class="line"><span class="comment"># 默认为 /var/log/xferlog，也可以通过 xferlog_file 选项对其进行设定</span></span><br><span class="line"><span class="comment"># 默认值为 YES</span></span><br><span class="line"><span class="string">xferlog_std_format=YES</span></span><br><span class="line"><span class="comment"># 设置数据传输中断间隔时间，此语句表示空闲的用户会话中断时间为 600 秒</span></span><br><span class="line"><span class="comment"># 即当数据传输结束后，用户连接 FTP 服务器的时间不应超过 600 秒。可以根据实际情况对该值进行修改</span></span><br><span class="line"><span class="comment">#idle_session_timeout=600</span></span><br><span class="line"><span class="comment"># 设置数据连接超时时间，该语句表示数据连接超时时间为 120 秒，可根据实际情况对其个修改</span></span><br><span class="line"><span class="comment">#data_connection_timeout=120</span></span><br><span class="line"><span class="comment"># 运行 vsftpd 需要的非特权系统用户，缺省是 nobody</span></span><br><span class="line"><span class="comment">#nopriv_user=ftpsecure</span></span><br><span class="line"><span class="comment"># 是否识别异步 ABOR 请求。</span></span><br><span class="line"><span class="comment"># 如果 FTP client 会下达 “async ABOR” 这个指令时，这个设定才需要启用</span></span><br><span class="line"><span class="comment"># 而一般此设定并不安全，所以通常将其注释</span></span><br><span class="line"><span class="comment">#async_abor_enable=YES</span></span><br><span class="line"><span class="comment"># 是否以 ASCII 方式传输数据。默认情况下，服务器会忽略 ASCII 方式的请求。</span></span><br><span class="line"><span class="comment"># 启用此选项将允许服务器以 ASCII 方式传输数据</span></span><br><span class="line"><span class="comment"># 不过，这样可能会导致由 "SIZE /big/file" 方式引起的 DoS 攻击</span></span><br><span class="line"><span class="comment">#ascii_upload_enable=YES</span></span><br><span class="line"><span class="comment">#ascii_download_enable=YES</span></span><br><span class="line"><span class="comment"># 登录 FTP 服务器时显示的欢迎信息</span></span><br><span class="line"><span class="comment"># 如有需要，可在更改目录欢迎信息的目录下创建名为 .message 的文件，并写入欢迎信息保存后</span></span><br><span class="line"><span class="comment">#ftpd_banner=Welcome to blah FTP service.</span></span><br><span class="line"><span class="comment"># 黑名单设置。可以阻止某些特殊的 email address 链接</span></span><br><span class="line"><span class="comment">#deny_email_enable=YES</span></span><br><span class="line"><span class="comment"># 当上面的 deny_email_enable=YES 时，可以利用这个设定项来规定哪些邮件地址不可登录 vsftpd 服务器</span></span><br><span class="line"><span class="comment"># 此文件需用户自己创建，通常情况下为一行一个 email address</span></span><br><span class="line"><span class="comment">#banned_email_file=/etc/vsftpd/banned_emails</span></span><br><span class="line"><span class="comment"># 用户登录 FTP 服务器后是否具有访问自己目录以外的其他文件的权限</span></span><br><span class="line"><span class="comment"># 设置为 YES 时，用户被锁定在自己的 home 目录中，vsftpd 将在下面 chroot_list_file 选项值的位置寻找 chroot_list 文件</span></span><br><span class="line"><span class="comment"># 必须与下面的设置项配合</span></span><br><span class="line"><span class="comment">#chroot_list_enable=YES</span></span><br><span class="line"><span class="comment"># 被列入此文件的用户，在登录后将不能切换到自己目录以外的其他目录</span></span><br><span class="line"><span class="comment"># 从而有利于 FTP 服务器的安全管理和隐私保护。此文件需自己建立</span></span><br><span class="line"><span class="comment">#chroot_list_file=/etc/vsftpd/chroot_list</span></span><br><span class="line"><span class="comment"># 是否允许递归查询。默认为关闭，以防止远程用户造成过量的 I/O</span></span><br><span class="line"><span class="comment">#ls_recurse_enable=YES</span></span><br><span class="line"><span class="comment"># 是否允许监听。</span></span><br><span class="line"><span class="comment"># 如果设置为 YES，则 vsftpd 将以独立模式运行，由 vsftpd 自己监听和处理 IPv4 端口的连接请求</span></span><br><span class="line"><span class="string">listen=NO</span></span><br><span class="line"><span class="comment"># 设定是否支持 IPV6</span></span><br><span class="line"><span class="string">listen_ipv6=YES</span></span><br><span class="line"><span class="comment"># 设置 PAM 外挂模块提供的认证服务所使用的配置文件名，即 /etc/pam.d/vsftpd 文件</span></span><br><span class="line"><span class="comment"># 此文件 中file=/etc/vsftpd/ftpusers 字段，说明了 PAM 模块能抵挡的帐号内容来自文件 /etc/vsftpd/ftpusers 中</span></span><br><span class="line"><span class="string">pam_service_name=vsftpd</span></span><br><span class="line"><span class="comment"># 是否允许 ftpusers 文件中的用户登录 FTP 服务器，默认为 YES</span></span><br><span class="line"><span class="comment"># 若此项设为 YES，则 user_list 文件中的用户允许登录 FTP 服务器</span></span><br><span class="line"><span class="comment"># 而如果同时设置了userlist_deny=YES，则 user_list 文件中的用户将不允许登录 FTP 服务器，甚至连输入密码提示信息都没有</span></span><br><span class="line"><span class="string">userlist_enable=YES</span></span><br></pre></td></tr></tbody></table></figure><p><code>/etc/vsftpd/ftpusers</code> 这个文件是禁止使用 vsftpd 的用户列表文件。记录不允许访问 FTP 服务器的用户名单，一般把一些对系统安全有威胁的用户账号记录在此文件中，以免用户从 FTP 登录后获得大于上传下载操作的权利，而对系统造成损坏。其默认值为：</p><p><a class="simple-lightbox" target="_blank" rel="noopener" href="http://cdn.codeover.cn/img/image-20220530230942689.png-imageFop"><img src="/images/loading.svg" data-src="http://cdn.codeover.cn/img/image-20220530230942689.png-imageFop" alt="默认值截图" lazyload=""></a></p><p><code>/etc/vsftpd/user_list</code> 文件是允许或禁止使用 vsftpd 的用户列表文件。这个文件中指定的用户缺省情况（即在 <code>/etc/vsftpd/vsftpd.conf</code> 中设置 <code>userlist_deny=YES</code>）下也不能访问 FTP 服务器，在设置了 <code>userlist_deny=NO</code> 时,仅允许 <code>user_list</code> 中指定的用户访问 FTP 服务器。</p><h2 id="用户访问模式"><a href="#用户访问模式" class="headerlink" title="用户访问模式"></a>用户访问模式</h2><p>vsftpd 服务访问模式有三种，分别是：匿名用户、系统用户和虚拟用户</p><h3 id="匿名用户模式"><a href="#匿名用户模式" class="headerlink" title="匿名用户模式"></a>匿名用户模式</h3><p>匿名模式即 FTP 服务器建立一个公开账户 (一般为 anonymous)，并赋予该账户访问公共目录的权限（默认为 <code>/var/ftp/pub</code>），该模式适合只在内网使用或公开文件的场景使用。默认情况下，匿名用户只有查看权限，无法创建、删除、修改。如果想要允许匿名用户能够上传、下载、删除文件，需在 <code>/etc/vsftpd/vsftpd.conf</code> 配置文件中修改：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">anon_upload_enable=YES</span>      <span class="comment"># 允许匿名用户上传文件；</span></span><br><span class="line"><span class="string">anon_mkdir_write_enable=YES</span> <span class="comment"># 允许匿名用户创建目录；</span></span><br><span class="line"><span class="string">anon_other_write_enable=YES</span> <span class="comment"># 允许匿名用户其他写入权限。</span></span><br></pre></td></tr></tbody></table></figure><p>vsftpd 默认的匿名用户有两个：<code>anonymous</code> 与 <code>ftp</code> ，所以如果需要使用匿名用户上传、删除文件需要 <code>anonymous</code> 用户对 <code>/var/ftp/pub</code> 目录有写入权限：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R ftp /var/ftp/pub/</span><br></pre></td></tr></tbody></table></figure><h3 id="系统用户模式"><a href="#系统用户模式" class="headerlink" title="系统用户模式"></a>系统用户模式</h3><p>如果在非内网情况下，匿名模式可以让任何人使用 ftp 服务，比较公开，多适用于共享文件。如果只想要部分特定用户使用，就需要使用系统用户登录访问，这种模式我们需要创建不同的用户：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">groupadd www <span class="comment"># 创建用户组</span></span><br><span class="line">useradd -g www www -s /sbin/nologin <span class="comment"># 创建用户</span></span><br></pre></td></tr></tbody></table></figure><p>参数说明：</p><ul><li><code>groupadd</code> 创建对应的用户组，参数 <code>www</code> 即创建的组名</li><li><code>useradd</code> 创建用户<ul><li><code>-g www</code> 指定用户组，<code>www</code> 即为指定的用户组名</li><li><code>www</code> 指定本次创建的用户名</li><li><code>-s /sbin/nologin</code> 禁止用户通过 <code>ssh</code> 登录系统</li></ul></li></ul><p>然后需要修改配置文件（<code>/etc/vsftpd/vsftpd.conf</code>）：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">anonymous_enable=NO</span>   <span class="comment"># 禁止匿名用户登录</span></span><br><span class="line"><span class="string">chown_uploads=NO</span>      <span class="comment"># 设定禁止上传文件更改宿主</span></span><br><span class="line"><span class="string">nopriv_user=ftptest</span>   <span class="comment"># 设定支撑 vsftpd 服务的宿主用户为新建用户</span></span><br><span class="line"><span class="string">ascii_upload_enable=YES</span></span><br><span class="line"><span class="string">ascii_download_enable=YES</span> <span class="comment"># 设定支持 ASCII 模式的上传和下载功能。</span></span><br><span class="line"><span class="string">userlist_enable=YES</span></span><br><span class="line"><span class="string">userlist_deny=NO</span></span><br></pre></td></tr></tbody></table></figure><p>然后修改 <code>/etc/vsftpd/user_list</code> 文件，将新建(或原有)的用户添加到文件的最后一行，这种模式下，登录 FTP 后访问的就是 <code>/home/www/</code>，即为当前用户的家目录</p><h3 id="虚拟用户配置"><a href="#虚拟用户配置" class="headerlink" title="虚拟用户配置"></a>虚拟用户配置</h3><p>系统用户模式可以有效的控制访问，但是随着使用用户增多，需要创建大量系统用户，这对服务器系统的管理产生了巨大影响，甚至对服务器安全造成威胁。这时我们就可以使用虚拟用户进行登录，以方便管理。</p><p>虚拟用户模式实际上没有真实的系统用户，其是通过映射到一个真实的用户以及设置的权限来实现访问验证，虚拟用户在 linux 中实际不存在，提升了系统的安全性。</p><ol><li><p>修改配置文件 <code>/etc/vsftpd/vsftpd.conf</code>：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">anonymous_enable=NO  <span class="comment"># 设定不允许匿名访问</span></span><br><span class="line">local_enable=YES  <span class="comment"># 设定本地用户可以访问。</span></span><br><span class="line">write_enable=YES  <span class="comment"># 设定可以进行写操作。</span></span><br><span class="line">local_umask=022  <span class="comment"># 设定上传后文件的权限掩码。</span></span><br><span class="line">anon_upload_enable=NO  <span class="comment"># 禁止匿名用户上传。</span></span><br><span class="line">anon_mkdir_write_enable=NO  <span class="comment"># 禁止匿名用户建立目录。</span></span><br><span class="line">dirmessage_enable=YES  <span class="comment"># 设定开启目录标语功能。</span></span><br><span class="line">xferlog_enable=YES  <span class="comment"># 设定开启日志记录功能。</span></span><br><span class="line">connect_from_port_20=YES <span class="comment"># 设定端口 20 进行数据连接。(主动模式)</span></span><br><span class="line">chown_uploads=NO  <span class="comment"># 设定禁止上传文件更改宿主。</span></span><br><span class="line">xferlog_file=/var/log/xferlog</span><br><span class="line"><span class="comment"># 设定 vsftpd 的服务日志保存路径。</span></span><br><span class="line">xferlog_std_format=YES <span class="comment"># 设定日志使用标准的记录格式。</span></span><br><span class="line">async_abor_enable=YES  <span class="comment">#设定支持异步传输功能。</span></span><br><span class="line">ascii_upload_enable=YES</span><br><span class="line">ascii_download_enable=YES  <span class="comment">#设定支持ASCII模式的上传和下载功能。</span></span><br><span class="line"></span><br><span class="line">chroot_list_enable=NO <span class="comment">#禁止用户登出自己的 FTP 主目录。</span></span><br><span class="line">ls_recurse_enable=NO  <span class="comment">#禁止用户登陆 FTP 后使用 "ls -R" 的命令。</span></span><br><span class="line">listen=YES</span><br><span class="line"></span><br><span class="line">userlist_enable=YES  <span class="comment"># 设定 userlist_file 中的用户将不得使用 FTP</span></span><br><span class="line">tcp_wrappers=YES  <span class="comment"># 设定支持 TCP Wrappers</span></span><br><span class="line"></span><br><span class="line">guest_enable=YES  <span class="comment"># 设定启用虚拟用户功能。</span></span><br><span class="line">guest_username=www  <span class="comment"># 指定虚拟用户的宿主用户，即 linux 中真实存在的用户</span></span><br><span class="line">virtual_use_local_privs=YES  <span class="comment"># 设定虚拟用户的权限符合他们的宿主用户。</span></span><br><span class="line">pam_service_name=vsftpd  <span class="comment"># 设定 PAM 服务下 vsftpd 的验证配置文件名。因此，PAM 验证将参考 /etc/pam.d/ 下的 vsftpd 文件配置。</span></span><br><span class="line">user_config_dir=/etc/vsftpd/virtualconf  <span class="comment"># 设定虚拟用户个人 vsftp 的配置文件存放路径。也就是说，这个被指定的目录里，将存放每个 vsftp 虚拟用户个性的配置文件，一个需要注意的地方就是这些配置文件名必须和虚拟用户名相同。</span></span><br></pre></td></tr></tbody></table></figure><p>随后需要创建对应的虚拟用户配置文件夹</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/vsftpd/virtualconf</span><br></pre></td></tr></tbody></table></figure></li><li><p>制作虚拟用户数据库文件 <code>vim /etc/vsftpd/virtusers</code>，这个文件的文件名以及路径是可以自定义的，用于储存虚拟用户用户名与密码的文件，在文件中写入如下内容：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">user1</span><br><span class="line">123456</span><br><span class="line">user2</span><br><span class="line">123456</span><br></pre></td></tr></tbody></table></figure><p>该文件格式为：一行用户名对应一行密码</p><p>随后生成虚拟用户数据文件：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">db_load <span class="built_in">hash</span> /etc/vsftpd/virtusers /etc/vsftpd/virtusers.db</span><br></pre></td></tr></tbody></table></figure></li><li><p>设置 PAM 验证文件，并指定上一步创建的虚拟用户数据库文件，vsftp 的 PAM 验证配置文件路径为 <code>/etc/pam.d/vsftpd</code> ，编辑该文件，并在文件末尾新增如下内容：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">#%PAM-1.0</span><br><span class="line">auth    sufficient      /lib/security/pam_userdb.so     db=/etc/vsftpd/virtusers</span><br><span class="line">account sufficient      /lib/security/pam_userdb.so     db=/etc/vsftpd/virtusers</span><br></pre></td></tr></tbody></table></figure><p>如当前系统是 64 位的，则需要使用如下内容：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">#%PAM-1.0</span><br><span class="line">auth    sufficient      /lib64/security/pam_userdb.so     db=/etc/vsftpd/virtusers</span><br><span class="line">account sufficient      /lib64/security/pam_userdb.so     db=/etc/vsftpd/virtusers</span><br></pre></td></tr></tbody></table></figure><p>其中 <code>/etc/vsftpd/virtusers</code> 为第二步生成的虚拟用户数据库文件。</p></li><li><p>修改虚拟用户配置文件，将虚拟用户配置文件存入 <code>/etc/vsftpd/virtualconf/</code> 目录，文件名为<em>虚拟用户名</em>，例如虚拟用户为 <code>user1</code>，则对应的文件名为 <code>/etc/vsftpd/virtualconf/user1</code>，对应配置项与主配置项基本相同，该配置文件未指定的内容则由主配置文件决定，对应配置项如下：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">local_root=/www/server/blog</span> <span class="comment"># 指定虚拟用户的具体主路径。</span></span><br><span class="line"><span class="string">write_enable=YES</span> <span class="comment"># 设定允许写操作。</span></span><br><span class="line"><span class="string">anon_upload_enable=NO</span> <span class="comment"># 设定不允许匿名用户上传。</span></span><br><span class="line"><span class="string">anon_mkdir_write_enable=NO</span> <span class="comment"># 设定不允许匿名用户建立目录。</span></span><br><span class="line"><span class="string">idle_session_timeout=600</span> <span class="comment"># 设定空闲连接超时时间。</span></span><br><span class="line"><span class="string">data_connection_timeout=120</span> <span class="comment"># 设定单次连续传输最大时间。</span></span><br><span class="line"><span class="string">max_clients=10</span> <span class="comment"># 设定并发客户端访问个数。</span></span><br><span class="line"><span class="string">max_per_ip=5</span> <span class="comment"># 设定单个客户端的最大线程数，这个配置主要来照顾 Flashget、迅雷等多线程下载软件。</span></span><br><span class="line"><span class="string">local_max_rate=50000</span> <span class="comment"># 设定该用户的最大传输速率，单位 b/s。</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>重启 vsftpd 即可使用虚拟用户连接：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">service vsftpd restart <span class="comment"># 重启</span></span><br></pre></td></tr></tbody></table></figure></li></ol></div><div class="top-div"><ol class="top-box"><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%89%E8%A3%85"><span class="top-box-text">服务端安装</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E9%85%8D%E7%BD%AE"><span class="top-box-text">配置</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="top-box-text">配置文件说明</span></a></li></ol></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%E6%A8%A1%E5%BC%8F"><span class="top-box-text">用户访问模式</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%8C%BF%E5%90%8D%E7%94%A8%E6%88%B7%E6%A8%A1%E5%BC%8F"><span class="top-box-text">匿名用户模式</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E6%A8%A1%E5%BC%8F"><span class="top-box-text">系统用户模式</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E8%99%9A%E6%8B%9F%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE"><span class="top-box-text">虚拟用户配置</span></a></li></ol></li></ol></div></div></div><div class="next-post"><a class="purple-link" href="/centos-install-redis/"><h3 class="post-title"> 下一篇：Centos 编译安装 redis 以及基础配置</h3></a></div></div><div id="gitalk-container"></div><footer><div class="site-footer"><div class="social-container"><a aria-label="跳转至github" href="https://github.com/f-dong" target="_blank"><i class="icon icon-github"></i></a></div> Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <a href="https://github.com/f-dong/hexo-theme-minimalism" target="_blank">Theme</a> | <a href="https://beian.miit.gov.cn" target="_blank">豫ICP备2022011962号</a> | <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=41010402002848" target="_blank">豫公网安备41010402002848号</a></div></footer></div><script id="hexo-configurations">window.theme_config={image:{lazyload_enable:!0,photo_zoom:"simple-lightbox"}},window.is_post=!0</script><script src="/js/main.js"></script><script src="/js/gitalk.min.js"></script><script>var gitalk=new Gitalk({clientID:"eaa8ec37487184406145",clientSecret:"77f9955d0267c1331df7cc706cfa385d2befb9c6",repo:"blog",owner:"f-dong",admin:["f-dong"],id:location.pathname.slice(1,location.pathname.lastIndexOf("/")).substring(0,49),distractionFreeMode:!1,createIssueManually:!0});gitalk.render("gitalk-container")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-2GM6102E19"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2GM6102E19")</script><script src="/js/simple-lightbox.min.js"></script><script>document.addEventListener("DOMContentLoaded",function(){new SimpleLightbox(".post-detail .simple-lightbox",{fileExt:!1,captionsData:"alt"})})</script></body></html>